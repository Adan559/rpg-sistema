<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Magia RPG - Fantasia Medieval</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Variáveis CSS para cores e propriedades globais */
        :root {
            --primary-color: #2e1a47; /* Roxo escuro */
            --secondary-color: #1a1a2e; /* Azul/Roxo muito escuro */
            --accent-color: #8a4fff; /* Roxo claro vibrante */
            --danger-color: #ff6b6b; /* Vermelho */
            --success-color: #4CAF50; /* Verde */
            --info-color: #2196F3; /* Azul */
            --text-light: #ffffff;
            --text-dark: #333333;
            --text-muted: #a0aec0; /* Cinza claro para texto secundário */
            --bg-dark: #0f0f1a; /* Fundo mais escuro */
            --bg-light: #f7fafc; /* Fundo claro */
            --border-radius: 0.5rem; /* 8px */
            --card-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            --transition: all 0.3s ease-in-out;

            /* Cores para elementos específicos (escolas/efeitos) */
            --fire-color: #ff5722;
            --ice-color: #4fc3f7;
            --earth-color: #8bc34a;
            --lightning-color: #ffeb3b;
            --dark-magic-color: #9c27b0;
            --void-color: #78909c;
            --light-magic-color: #ffdd00;

            /* Cores RGB para uso com rgba() */
            --primary-rgb: 46, 26, 71;
            --accent-rgb: 138, 79, 255;
            --danger-rgb: 255, 107, 107;
            --success-rgb: 76, 175, 80;
            --info-rgb: 33, 150, 243;
        }

        body {
            font-family: 'Poppins', sans-serif;
            line-height: 1.6;
            color: var(--text-dark);
            background-color: var(--bg-light);
            background-image: url('https://placehold.co/1920x1080/0f0f1a/0f0f1a?text=olá'); /* Placeholder, substitua por uma imagem real */
            background-attachment: fixed;
            background-size: cover;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        h1, h2, h3, h4, h5, h6 {
            font-family: 'Cinzel', serif;
            font-weight: 600;
            color: var(--primary-color);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
        }

        .section {
            padding: 5rem 0;
        }

        .section-title {
            font-size: 2.5rem;
            text-align: center;
            margin-bottom: 1.5rem;
            position: relative;
            color: var(--primary-color); /* Padrão para seções claras */
        }
        .section-title::after {
            content: '';
            display: block;
            width: 80px;
            height: 4px;
            background: var(--accent-color);
            margin: 15px auto;
            border-radius: 2px;
        }

        .section-description {
            text-align: center;
            max-width: 800px;
            margin: 0 auto 3rem;
            color: var(--text-muted);
            font-size: 1.1rem;
        }

        /* Cores de título e descrição para seções escuras */
        .bg-dark .section-title,
        .bg-dark .section-description {
            color: var(--text-light);
        }

        /* Botões Base */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.75rem 1.5rem;
            border-radius: var(--border-radius);
            font-weight: 600;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            border: none;
            font-size: 1rem;
            gap: 0.5rem;
        }

        .btn-primary {
            background-color: var(--accent-color);
            color: var(--text-light);
        }
        .btn-primary:hover {
            background-color: var(--primary-color);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(var(--accent-rgb), 0.3);
        }

        .btn-secondary {
            background-color: transparent;
            color: var(--accent-color);
            border: 2px solid var(--accent-color);
        }
        .btn-secondary:hover {
            background-color: var(--accent-color);
            color: var(--text-light);
            transform: translateY(-2px);
        }

        .btn.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-danger {
            background-color: var(--danger-color);
            color: var(--text-light);
        }
        .btn-danger:hover {
            background-color: rgba(var(--danger-rgb), 0.8);
        }

        /* Header e Navegação */
        .main-header {
            background-color: rgba(26, 26, 46, 0.95);
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 1000;
            padding: 0.9375rem 0; /* 15px */
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .main-header .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
        }

        .logo img {
            height: 40px;
            margin-right: 0.625rem; /* 10px */
        }

        .logo h1 {
            color: var(--text-light);
            font-size: 1.5rem;
            margin: 0;
        }

        .main-nav .nav-links {
            display: flex;
            list-style: none;
        }

        .main-nav .nav-links li {
            margin-left: 1.25rem; /* 20px */
        }

        .main-nav .nav-links a {
            color: var(--text-light);
            font-weight: 500;
            padding: 0.3125rem 0.625rem; /* 5px 10px */
            border-radius: var(--border-radius);
            transition: var(--transition);
        }

        .main-nav .nav-links a:hover,
        .main-nav .nav-links a.active {
            background-color: var(--accent-color);
            color: var(--text-light);
        }

        .menu-toggle {
            display: none;
            background: none;
            border: none;
            color: var(--text-light);
            font-size: 1.5rem;
            cursor: pointer;
        }

        /* Hero Section */
        .hero-section {
            height: 100vh;
            min-height: 600px;
            display: flex;
            align-items: center;
            position: relative;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: var(--text-light);
            overflow: hidden;
            padding-top: 70px;
        }

        .hero-section .container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: relative;
            z-index: 2;
        }

        .hero-content {
            max-width: 600px;
        }

        .hero-title {
            font-size: 3.5rem;
            margin-bottom: 1.5rem;
            color: var(--text-light);
        }

        .hero-description {
            font-size: 1.2rem;
            margin-bottom: 2rem;
            color: rgba(255, 255, 255, 0.9);
        }

        .hero-buttons {
            display: flex;
            gap: 15px;
        }

        .hero-image {
            max-width: 40%;
        }

        .scroll-indicator {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            color: var(--text-light);
            opacity: 0.7;
            animation: bounce 2s infinite;
        }

        .scroll-indicator i {
            margin-top: 8px;
            font-size: 1.2rem;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }

        /* Tabs */
        .tabs-container {
            margin-top: 2rem;
        }
        .tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 2rem;
            border-bottom: 2px solid #eee;
        }
        .tab-btn {
            padding: 12px 24px;
            background: none;
            border: none;
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-muted);
            cursor: pointer;
            transition: var(--transition);
            position: relative;
        }
        .tab-btn:hover { color: var(--accent-color); }
        .tab-btn.active { color: var(--accent-color); }
        .tab-btn.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 100%;
            height: 3px;
            background-color: var(--accent-color);
        }
        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        .tab-content.active { display: block; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* PA System (Sistema de Magia) */
        .pa-system {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            margin-bottom: 3rem;
            align-items: center;
            justify-content: center;
        }
        .pa-info {
            flex: 1;
            min-width: 300px;
        }
        .pa-rules {
            list-style: none;
            margin-top: 1rem;
        }
        .pa-rules li {
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            color: var(--text-dark);
        }
        .pa-rules li i {
            margin-right: 10px;
            color: var(--accent-color);
        }
        .pa-visual {
            flex: 1;
            min-width: 300px;
            background-color: rgba(var(--primary-rgb), 0.05);
            padding: 20px;
            border-radius: var(--border-radius);
            text-align: center;
        }
        .pa-counter {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }
        .pa-orb {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            margin: 0 5px;
            background-color: #ddd;
            transition: var(--transition);
        }
        .pa-orb.active {
            background-color: var(--accent-color);
            box-shadow: 0 0 10px rgba(var(--accent-rgb), 0.5);
        }
        .pa-actions {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .pa-action {
            padding: 10px;
            background-color: white;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
        }
        .pa-action:hover { background-color: #f5f5f5; }
        .pa-action.disabled { opacity: 0.5; cursor: not-allowed; }
        .pa-reset {
            margin-top: 10px;
            padding: 10px;
            background-color: var(--accent-color);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
        }
        .pa-reset:hover { background-color: var(--primary-color); }

        /* Magic Types */
        .magic-types {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
        }
        .magic-type {
            flex: 1;
            min-width: 300px;
            max-width: 350px;
            padding: 25px;
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow);
            text-align: center;
            transition: var(--transition);
            background-color: white;
        }
        .magic-type:hover { transform: translateY(-5px); }
        .magic-type.attack { border-top: 4px solid var(--danger-color); }
        .magic-type.support { border-top: 4px solid var(--success-color); }
        .magic-type.control { border-top: 4px solid var(--info-color); }
        .type-icon {
            width: 60px; height: 60px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            margin: 0 auto 15px; font-size: 1.5rem;
        }
        .attack .type-icon { background-color: rgba(var(--danger-rgb), 0.1); color: var(--danger-color); }
        .support .type-icon { background-color: rgba(var(--success-rgb), 0.1); color: var(--success-color); }
        .control .type-icon { background-color: rgba(var(--info-rgb), 0.1); color: var(--info-color); }

        /* Escolas & Elementos Section */
        .escolas-section {
            background-color: var(--bg-dark);
            color: var(--text-light);
        }
        .escolas-container, .elementos-container {
            margin-top: 3rem;
        }
        .escolas-container h3, .elementos-container h3 {
            text-align: center;
            color: var(--text-light);
            margin-bottom: 2rem;
        }
        .escolas-grid, .elementos-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }
        .escola-card, .elemento-card {
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: var(--border-radius);
            padding: 20px;
            text-align: center;
            transition: var(--transition);
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .escola-card:hover, .elemento-card:hover {
            transform: translateY(-5px);
            background-color: rgba(255, 255, 255, 0.1);
        }
        .escola-icon, .elemento-card .elemento-icon {
            width: 60px; height: 60px; border-radius: 50%;
            background-color: rgba(var(--accent-rgb), 0.2);
            color: var(--text-light);
            display: flex; align-items: center; justify-content: center;
            margin: 0 auto 15px; font-size: 1.5rem;
        }
        .escola-card h4, .elemento-card h4 {
            color: var(--text-light);
            margin-bottom: 10px;
        }
        .escola-card p, .elemento-card p {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
            margin-bottom: 15px;
        }
        .btn-details {
            background-color: transparent;
            border: 1px solid var(--accent-color);
            color: var(--accent-color);
            padding: 8px 16px;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
        }
        .btn-details:hover {
            background-color: var(--accent-color);
            color: var(--text-light);
        }
        .elementos-selector {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin-bottom: 2rem;
        }
        .elemento-btn {
            padding: 10px 20px;
            background-color: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--text-light);
            border-radius: 20px;
            cursor: pointer;
            transition: var(--transition);
        }
        .elemento-btn:hover, .elemento-btn.active {
            background-color: var(--accent-color);
        }
        .elemento-details {
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: var(--border-radius);
            padding: 30px;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .elemento-content {
            display: none;
            flex-wrap: wrap;
            gap: 30px;
            animation: fadeIn 0.5s ease;
        }
        .elemento-content.active { display: flex; }
        .elemento-visual {
            flex: 1; min-width: 250px;
            display: flex; align-items: center; justify-content: center;
        }
        .elemento-icon-display {
            width: 150px; height: 150px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 3rem; position: relative;
        }
        .elemento-icon-display::before {
            content: '';
            position: absolute;
            width: 100%; height: 100%;
            border-radius: 50%;
            opacity: 0.4;
        }
        /* Específicos para os ícones e suas cores de fundo */
        .fire-icon::before { background-color: var(--fire-color); }
        .ice-icon::before { background-color: var(--ice-color); }
        .earth-icon::before { background-color: var(--earth-color); }
        .lightning-icon::before { background-color: var(--lightning-color); }
        .dark-magic-icon::before { background-color: var(--dark-magic-color); }
        .void-icon::before { background-color: var(--void-color); }
        .light-magic-icon::before { background-color: var(--light-magic-color); }

        .elemento-info {
            flex: 2;
            min-width: 300px;
        }
        .elemento-info h4 {
            color: var(--text-light);
            font-size: 1.8rem;
            margin-bottom: 15px;
        }
        .elemento-info h5 {
            color: var(--text-light);
            margin-top: 15px;
            margin-bottom: 5px;
        }
        .elemento-info p {
            color: rgba(255, 255, 255, 0.8);
        }
        .elemento-info ul {
            list-style-type: disc;
            margin-left: 20px;
            color: rgba(255, 255, 255, 0.8);
        }

        /* Efeitos de Status Section */
        .efeitos-section {
            background-color: var(--bg-light);
        }
        .efeitos-filter {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 2rem;
        }
        .filter-btn {
            padding: 10px 20px;
            background-color: transparent;
            border: 1px solid var(--accent-color);
            color: var(--accent-color);
            border-radius: 20px;
            cursor: pointer;
            transition: var(--transition);
        }
        .filter-btn:hover, .filter-btn.active {
            background-color: var(--accent-color);
            color: var(--text-light);
        }
        .efeitos-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
        }
        .efeito-card {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--card-shadow);
            transition: var(--transition);
        }
        .efeito-card:hover { transform: translateY(-5px); }
        .efeito-card.positivo { border-left: 4px solid var(--success-color); }
        .efeito-card.negativo { border-left: 4px solid var(--danger-color); }
        .efeito-icon {
            width: 50px; height: 50px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            margin-bottom: 15px; font-size: 1.2rem;
        }
        .positivo .efeito-icon { background-color: rgba(var(--success-rgb), 0.1); color: var(--success-color); }
        .negativo .efeito-icon { background-color: rgba(var(--danger-rgb), 0.1); color: var(--danger-color); }
        .efeito-card h4 { margin-bottom: 10px; }
        .efeito-details-info {
            display: flex; justify-content: space-between; margin-top: 15px;
            font-size: 0.9rem; color: var(--text-muted);
        }

        /* Criação de Magias Section (Wizard) */
        .criacao-section {
            background-color: var(--bg-dark);
            color: var(--text-light);
        }
        .criacao-wizard {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            margin-top: 3rem;
        }
        .wizard-progress {
            display: flex;
            justify-content: space-between;
            width: 100%;
            margin-bottom: 2rem;
            position: relative;
        }
        .wizard-progress::before {
            content: ''; position: absolute; top: 15px; left: 0;
            width: 100%; height: 2px; background-color: rgba(255, 255, 255, 0.1);
            z-index: 1;
        }
        .progress-step {
            position: relative; z-index: 2; text-align: center; width: 16.66%;
        }
        .step-number {
            width: 30px; height: 30px; border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.1); color: var(--text-light);
            display: flex; align-items: center; justify-content: center;
            margin: 0 auto 10px; transition: var(--transition);
        }
        .progress-step.active .step-number { background-color: var(--accent-color); }
        .step-label {
            font-size: 0.9rem; color: rgba(255, 255, 255, 0.7);
        }
        .progress-step.active .step-label { color: var(--text-light); }

        .wizard-content {
            flex: 2; min-width: 500px;
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: var(--border-radius); padding: 30px;
            backdrop-filter: blur(5px); border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .wizard-step { display: none; }
        .wizard-step.active { display: block; animation: fadeIn 0.5s ease; }
        .wizard-step h3 { color: var(--text-light); margin-bottom: 10px; }
        .wizard-step p { color: rgba(255, 255, 255, 0.7); margin-bottom: 20px; }
        .form-group { margin-bottom: 20px; }
        .form-group label {
            display: block; margin-bottom: 8px; color: var(--text-light);
        }
        .form-group input, .form-group textarea, .form-group select {
            width: 100%; padding: 12px; border-radius: var(--border-radius);
            border: 1px solid rgba(255, 255, 255, 0.1);
            background-color: rgba(255, 255, 255, 0.05);
            color: var(--text-light); font-family: 'Poppins', sans-serif;
        }
        .form-group textarea { min-height: 100px; resize: vertical; }
        .wizard-buttons { display: flex; justify-content: space-between; margin-top: 30px; }
        .tipo-selector { display: flex; flex-wrap: wrap; gap: 15px; margin-top: 10px; }
        .tipo-option {
            flex: 1; min-width: 150px; padding: 15px;
            background-color: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1); border-radius: var(--border-radius);
            text-align: center; cursor: pointer; transition: var(--transition);
        }
        .tipo-option:hover { background-color: rgba(255, 255, 255, 0.1); }
        .tipo-option.selected {
            background-color: rgba(var(--accent-rgb), 0.2);
            border-color: var(--accent-color);
            box-shadow: 0 0 15px rgba(var(--accent-rgb), 0.3);
        }
        .tipo-option .tipo-icon {
            width: 40px; height: 40px; border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.1); color: var(--text-light);
            display: flex; align-items: center; justify-content: center;
            margin: 0 auto 10px; font-size: 1rem;
        }
        .tipo-option h4 { color: var(--text-light); margin-bottom: 5px; font-size: 1rem; }
        .tipo-option p { color: rgba(255, 255, 255, 0.7); font-size: 0.8rem; margin-bottom: 0; }
        .hidden { display: none; }

        .option-group { display: flex; flex-wrap: wrap; gap: 10px; }
        .option-item {
            background-color: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--border-radius); padding: 10px 15px;
            cursor: pointer; transition: background-color 0.3s ease, border-color 0.3s ease;
            color: rgba(255, 255, 255, 0.7);
        }
        .option-item:hover { background-color: rgba(255, 255, 255, 0.1); }
        .option-item.selected {
            background-color: var(--accent-color);
            border-color: var(--accent-color);
            color: var(--text-light);
        }
        .selected-effects-list {
            margin-top: 15px; background-color: rgba(255, 255, 255, 0.03);
            border-radius: var(--border-radius); padding: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1); min-height: 50px;
        }
        .selected-effect-item {
            display: flex; justify-content: space-between; align-items: center;
            background-color: rgba(255, 255, 255, 0.1); padding: 8px 12px;
            border-radius: 6px; margin-bottom: 8px; color: var(--text-light);
        }
        .remove-effect-btn {
            background: none; border: none; color: var(--danger-color);
            font-size: 1.2em; cursor: pointer; margin-left: 10px;
            transition: transform 0.2s ease;
        }
        .remove-effect-btn:hover { transform: scale(1.1); }
        .magia-preview { flex: 1; min-width: 300px; }
        .preview-card {
            background-color: rgba(255, 255, 255, 0.05); border-radius: var(--border-radius);
            overflow: hidden; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .preview-header { background-color: var(--primary-color); padding: 15px; text-align: center; }
        .preview-header h4 { color: var(--text-light); margin-bottom: 5px; }
        .preview-header span { color: rgba(255, 255, 255, 0.7); font-size: 0.9rem; }
        .preview-body { padding: 20px; }
        .preview-body p { color: rgba(255, 255, 255, 0.9); margin-bottom: 15px; }
        .preview-stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        .preview-stat-item {
            background-color: rgba(255, 255, 255, 0.05); padding: 8px;
            border-radius: var(--border-radius); font-size: 0.9rem; color: rgba(255, 255, 255, 0.8);
        }
        .preview-cost-display { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .pa-cost-display {
            display: flex; flex-direction: column; align-items: center;
            background-color: var(--accent-color); width: 60px; height: 60px;
            border-radius: 50%; padding: 10px;
        }
        .pa-value-display { font-size: 1.5rem; font-weight: 700; color: var(--text-light); }
        .pa-label-display { font-size: 0.8rem; color: rgba(255, 255, 255, 0.8); }
        .preview-cooldown-display {
            background-color: rgba(255, 255, 255, 0.05); padding: 8px 15px;
            border-radius: 20px; font-size: 0.9rem; color: rgba(255, 255, 255, 0.8);
        }
        .preview-effects-display h5 { color: var(--text-light); margin-bottom: 5px; }
        .preview-effects-display p { font-size: 0.9rem; color: rgba(255, 255, 255, 0.7); }

        /* Ficha de Personagem Section */
        .ficha-section {
            background-color: var(--bg-light);
        }
        .ficha-container {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 30px;
            box-shadow: var(--card-shadow);
        }
        .ficha-section-title {
            margin: 30px 0 15px;
            display: flex; align-items: center;
        }
        .ficha-section-title h3 {
            margin: 0; font-size: 1.5rem; color: var(--primary-color);
        }
        .section-divider {
            flex-grow: 1; height: 2px;
            background-color: rgba(var(--primary-rgb), 0.1); margin-left: 15px;
        }
        .ficha-row { display: flex; flex-wrap: wrap; gap: 20px; margin-bottom: 20px; }
        .col-2 { flex: 1; min-width: 300px; }
        .col-3 { flex: 1; min-width: 200px; }
        .form-group-ficha label {
            display: block; margin-bottom: 0.5rem; color: var(--text-dark); font-weight: 500;
        }
        .form-group-ficha input, .form-group-ficha select, .form-group-ficha textarea {
            width: 100%; padding: 0.625rem; border: 1px solid #ddd;
            border-radius: var(--border-radius); font-size: 1rem; color: var(--text-dark);
            background-color: #fcfcfc;
        }
        .form-group-ficha textarea { resize: vertical; min-height: 100px; }

        /* Atributos */
        .atributos-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 20px; margin-bottom: 30px;
        }
        .atributo-card {
            background-color: rgba(var(--primary-rgb), 0.05);
            border-radius: var(--border-radius); padding: 15px;
            text-align: center; transition: var(--transition);
        }
        .atributo-card:hover { transform: translateY(-5px); box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1); }
        .atributo-nome { font-weight: 600; margin-bottom: 10px; color: var(--primary-color); }
        .atributo-valor input {
            width: 60px; text-align: center; padding: 8px; border: 1px solid #ddd;
            border-radius: var(--border-radius); font-size: 1.2rem; font-weight: 600;
        }
        .atributo-mod { font-size: 1.1rem; font-weight: 600; color: var(--accent-color); }

        /* Recursos de Combate */
        .recursos-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px; margin-bottom: 30px;
        }
        .recurso-card {
            background-color: rgba(var(--primary-rgb), 0.05);
            border-radius: var(--border-radius); padding: 15px;
            transition: var(--transition);
        }
        .recurso-card:hover { transform: translateY(-5px); box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1); }
        .recurso-nome { font-weight: 600; margin-bottom: 10px; color: var(--primary-color); }
        .recurso-valor { display: flex; align-items: center; justify-content: center; gap: 5px; }
        .recurso-valor input {
            width: 60px; text-align: center; padding: 8px; border: 1px solid #ddd;
            border-radius: var(--border-radius); font-size: 1.1rem;
        }

        /* Especializações Mágicas */
        .especializacoes-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 30px; margin-bottom: 30px;
        }
        .especializacao-grupo {
            background-color: white; border-radius: var(--border-radius);
            padding: 20px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }
        .especializacao-grupo h4 {
            margin-top: 0; margin-bottom: 15px; color: var(--primary-color);
        }
        .especializacao-item {
            display: flex; align-items: center; margin-bottom: 10px;
        }
        .especializacao-item input[type="checkbox"] {
            margin-right: 10px; transform: scale(1.2);
        }
        .especializacao-item label {
            color: var(--text-dark); font-weight: 400;
        }
        .especializacao-item span {
            font-size: 0.9em; color: var(--text-muted); margin-left: auto;
        }

        /* Magias do Personagem */
        .magias-personagem-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }
        .magia-ficha-card {
            background-color: rgba(var(--primary-rgb), 0.03);
            border-radius: var(--border-radius); padding: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            position: relative;
        }
        .magia-ficha-card h5 { margin-bottom: 5px; color: var(--primary-color); }
        .magia-ficha-card p { font-size: 0.9rem; color: var(--text-muted); }
        .magia-ficha-card .magia-details { margin-top: 10px; font-size: 0.85rem; color: var(--text-dark); }
        .magia-ficha-actions {
            display: flex; gap: 10px; margin-top: 15px;
        }
        .magia-ficha-actions .btn {
            padding: 8px 12px; font-size: 0.9rem;
        }
        .magia-delete-btn {
            position: absolute; top: 10px; right: 10px;
            background: none; border: none; color: var(--danger-color);
            cursor: pointer; font-size: 1.1rem;
        }
        .magia-delete-btn:hover { transform: scale(1.1); }

        /* Biblioteca de Magias */
        .library-filters {
            display: flex; flex-wrap: wrap; gap: 15px; justify-content: center;
            margin-bottom: 2rem;
        }
        .library-filters input, .library-filters select {
            padding: 8px 12px; border-radius: var(--border-radius);
            border: 1px solid #ddd; background-color: white;
            color: var(--text-dark);
        }
        .library-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
        }
        .library-magic-card {
            background-color: white; border-radius: var(--border-radius);
            padding: 20px; box-shadow: var(--card-shadow);
            transition: var(--transition); position: relative;
        }
        .library-magic-card:hover { transform: translateY(-5px); }
        .library-magic-card h4 { margin-bottom: 5px; color: var(--primary-color); }
        .library-magic-card p { font-size: 0.9rem; color: var(--text-muted); }
        .library-card-actions {
            display: flex; justify-content: flex-end; gap: 10px; margin-top: 15px;
        }
        .library-card-actions .btn {
            padding: 6px 10px; font-size: 0.85rem;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1001;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.7);
            align-items: center;
            justify-content: center;
        }
        .modal-content {
            background-color: var(--bg-dark);
            margin: auto;
            padding: 30px;
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow);
            max-width: 500px;
            color: var(--text-light);
            position: relative;
            animation: fadeIn 0.3s ease-out;
        }
        .close-button {
            color: var(--text-muted);
            position: absolute;
            top: 15px;
            right: 25px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        .close-button:hover,
        .close-button:focus {
            color: var(--text-light);
            text-decoration: none;
            cursor: pointer;
        }
        .modal-body h3 { color: var(--text-light); margin-bottom: 15px; }
        .modal-body p { margin-bottom: 15px; color: rgba(255, 255, 255, 0.8); }
        .modal-body textarea {
            width: 100%; min-height: 150px;
            background-color: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--text-light); padding: 10px;
            border-radius: var(--border-radius); resize: vertical;
        }
        .modal-actions {
            display: flex; justify-content: flex-end; gap: 10px; margin-top: 20px;
        }

        /* Responsividade */
        @media (max-width: 900px) {
            .hero-section .container {
                flex-direction: column;
                text-align: center;
            }
            .hero-content {
                max-width: 100%;
                margin-bottom: 2rem;
            }
            .hero-image {
                max-width: 70%;
            }
            .hero-title {
                font-size: 2.8rem;
            }
            .hero-buttons {
                justify-content: center;
            }
            .main-nav .nav-links {
                display: none;
                flex-direction: column;
                width: 100%;
                background-color: rgba(26, 26, 46, 0.9);
                position: absolute;
                top: 70px;
                left: 0;
                padding: 1rem 0;
                border-top: 1px solid rgba(255, 255, 255, 0.1);
            }
            .main-nav .nav-links.active {
                display: flex;
            }
            .main-nav .nav-links li {
                margin: 0.5rem 0;
                text-align: center;
            }
            .menu-toggle {
                display: block;
            }
            .criacao-wizard {
                flex-direction: column;
                align-items: center;
            }
            .wizard-content, .magia-preview {
                min-width: unset;
                width: 100%;
            }
            .wizard-progress {
                flex-wrap: wrap;
                justify-content: center;
            }
            .progress-step {
                width: 33%; /* Adjust for smaller screens */
                margin-bottom: 10px;
            }
            .pa-system {
                flex-direction: column;
            }
            .pa-info, .pa-visual {
                min-width: unset;
                width: 100%;
            }
        }

        @media (max-width: 600px) {
            .hero-title {
                font-size: 2rem;
            }
            .hero-description {
                font-size: 1rem;
            }
            .btn {
                padding: 0.6rem 1.2rem;
                font-size: 0.9rem;
            }
            .section-title {
                font-size: 2rem;
            }
            .magic-type, .escola-card, .elemento-card, .efeito-card, .atributo-card, .recurso-card, .especializacao-grupo, .library-magic-card, .magia-ficha-card {
                min-width: unset;
                width: 100%;
            }
            .tabs {
                flex-wrap: wrap;
            }
            .tab-btn {
                width: 100%;
                margin-bottom: 5px;
            }
            .ficha-row {
                flex-direction: column;
            }
            .col-2, .col-3 {
                min-width: unset;
                width: 100%;
            }
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <header class="main-header">
        <div class="container">
            <a href="#home" class="logo">
                <img src="imagens/logo-small.png" alt="Magic System Logo">
                <h1 class="text-white text-2xl font-bold font-cinzel">Sistema de Magia RPG</h1>
            </a>
            <nav class="main-nav">
                <button class="menu-toggle" aria-label="Toggle navigation">
                    <i class="fas fa-bars"></i>
                </button>
                <ul class="nav-links">
                    <li><a href="#home" class="active">Home</a></li>
                    <li><a href="#system">Sistema de Magia</a></li>
                    <li><a href="#magic-creation">Criar Magia</a></li>
                    <li><a href="#library">Biblioteca</a></li>
                    <li><a href="#character-sheet">Ficha de Personagem</a></li>
                    <li><a href="#about">Sobre</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main class="flex-grow">
        <section id="home" class="hero-section">
            <div class="container">
                <div class="hero-content">
                    <h2 class="hero-title">Desvende o Poder: Seu Guia Completo do Sistema de Magia RPG do Adm </h2>
                    <p class="hero-description">Domine a arte da magia com a versão atualizada do Sistema de Magia RPG do Adm. Crie, personalize e integre feitiços como nunca antes. Prepare-se para uma experiência inesquecível em suas aventuras! </p>
                    <div class="hero-buttons">
                        <a href="#magic-creation" class="btn btn-primary">
                            <i class="fas fa-hat-wizard"></i> Criar Sua Primeira Magia
                        </a>
                        <a href="#system" class="btn btn-secondary">
                            <i class="fas fa-book-open"></i> Explorar o Sistema
                        </a>
                    </div>
                </div>
                <div class="hero-image hidden md:block">
                    <img src="imagens/logo.png" alt="Magic Orb" class="w-full">
                </div>
                <div class="scroll-indicator">
<span>Role para baixo</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
            </div>
        </section>

        <section id="system" class="section bg-light">
            <div class="container">
                <h2 class="section-title">O Sistema de Magia</h2>
                <p class="section-description">Descubra as regras, tipos de magia, escolas, elementos e efeitos de status que moldam o universo mágico de suas aventuras.</p>

                <div class="tabs-container">
                    <div class="tabs" role="tablist">
                        <button class="tab-btn active" data-tab="pa-system" role="tab" aria-selected="true" aria-controls="pa-system-content" id="tab-pa-system">
                            <i class="fas fa-magic"></i> Pontos de Ação (PA)
                        </button>
                        <button class="tab-btn" data-tab="magic-types" role="tab" aria-selected="false" aria-controls="magic-types-content" id="tab-magic-types">
                            <i class="fas fa-sparkles"></i> Tipos de Magia
                        </button>
                        <button class="tab-btn" data-tab="schools-elements" role="tab" aria-selected="false" aria-controls="schools-elements-content" id="tab-schools-elements">
                            <i class="fas fa-scroll"></i> Escolas & Elementos
                        </button>
                        <button class="tab-btn" data-tab="status-effects" role="tab" aria-selected="false" aria-controls="status-effects-content" id="tab-status-effects">
                            <i class="fas fa-hand-sparkles"></i> Efeitos de Status
                        </button>
                    </div>

                    <div id="pa-system-content" class="tab-content active" role="tabpanel" aria-labelledby="tab-pa-system">
                        <div class="pa-system">
                            <div class="pa-info">
                                <h3 class="text-2xl font-cinzel text-primary-color mb-4">Sistema de Pontos de Ação (PA)</h3>
                                <p class="text-gray-700 mb-4">O sistema de Pontos de Ação (PA) gerencia o custo e a frequência de suas magias. Cada magia consome uma certa quantidade de PA.</p>
                                <ul class="pa-rules">
                                    <li><i class="fas fa-dot-circle"></i> Comece com 3 PA no início de cada combate.</li>
                                    <li><i class="fas fa-dot-circle"></i> Ganhe 1 PA por turno.</li>
                                    <li><i class="fas fa-dot-circle"></i> O limite máximo de PA é 5.</li>
                                    <li><i class="fas fa-dot-circle"></i> Usar uma magia consome PA igual ao seu custo.</li>
                                    <li><i class="fas fa-dot-circle"></i> Se não tiver PA suficiente, não pode lançar a magia.</li>
                                </ul>
                            </div>
                            <div class="pa-visual">
                                <h4 class="text-xl font-cinzel text-primary-color mb-4">Seus Pontos de Ação Atuais</h4>
                                <div id="pa-counter" class="pa-counter">
                                    <div class="pa-orb" id="pa-orb-1"></div>
                                    <div class="pa-orb" id="pa-orb-2"></div>
                                    <div class="pa-orb" id="pa-orb-3"></div>
                                    <div class="pa-orb" id="pa-orb-4"></div>
                                    <div class="pa-orb" id="pa-orb-5"></div>
                                </div>
                                <div class="pa-actions">
                                    <button id="add-pa-btn" class="pa-action">Adicionar 1 PA <i class="fas fa-plus"></i></button>
                                    <button id="use-pa-btn" class="pa-action">Usar 1 PA <i class="fas fa-minus"></i></button>
                                    <button id="reset-pa-btn" class="pa-reset">Redefinir PA <i class="fas fa-redo"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="magic-types-content" class="tab-content" role="tabpanel" aria-labelledby="tab-magic-types">
                        <div class="magic-types">
                            <div class="magic-type attack">
                                <div class="type-icon"><i class="fas fa-bomb"></i></div>
                                <h3 class="text-xl font-cinzel text-primary-color mb-2">Magias de Ataque</h3>
                                <p class="text-gray-700">Feitiços focados em causar dano ou efeitos negativos diretos aos inimigos. Essenciais para o combate ofensivo.</p>
                                <ul class="text-sm text-gray-600 list-disc list-inside mt-4">
                                    <li>Bola de Fogo, Raio Congelante, Dardo Elétrico.</li>
                                    <li>Explosões, projeções elementais, maldições ofensivas.</li>
                                </ul>
                            </div>
                            <div class="magic-type support">
                                <div class="type-icon"><i class="fas fa-heart-pulse"></i></div>
                                <h3 class="text-xl font-cinzel text-primary-color mb-2">Magias de Suporte</h3>
                                <p class="text-gray-700">Feitiços que curam aliados, concedem bônus, ou fornecem utilidade tática. Cruciais para a sobrevivência e estratégia do grupo.</p>
                                <ul class="text-sm text-gray-600 list-disc list-inside mt-4">
                                    <li>Cura Leve, Escudo Arcane, Velocidade.</li>
                                    <li>Bençãos, buffs de atributo, barreiras protetoras.</li>
                                </ul>
                            </div>
                            <div class="magic-type control">
                                <div class="type-icon"><i class="fas fa-brain"></i></div>
                                <h3 class="text-xl font-cinzel text-primary-color mb-2">Magias de Controle</h3>
                                <p class="text-gray-700">Feitiços que manipulam o campo de batalha, restringem inimigos ou criam obstáculos. Ideal para controlar o fluxo do combate.</p>
                                <ul class="text-sm text-gray-600 list-disc list-inside mt-4">
                                    <li>Teia, Imobilizar Pessoa, Nevoa Obscurecedora.</li>
                                    <li>Armadilhas, ilusões, campos de força.</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div id="schools-elements-content" class="tab-content bg-dark" role="tabpanel" aria-labelledby="tab-schools-elements">
                        <div class="escolas-container">
                            <h3 class="text-3xl font-cinzel text-text-light mb-8">Escolas de Magia</h3>
                            <div class="escolas-grid">
                                <div class="escola-card">
                                    <div class="escola-icon"><i class="fas fa-meteor"></i></div>
                                    <h4 class="text-xl font-cinzel mb-2">Evocação</h4>
                                    <p>Focada em invocar forças elementais e energia pura para efeitos destrutivos ou construtivos.</p>
                                    <button class="btn-details">Ver Detalhes</button>
                                </div>
                                <div class="escola-card">
                                    <div class="escola-icon"><i class="fas fa-hand-sparkles"></i></div>
                                    <h4 class="text-xl font-cinzel mb-2">Ilusão</h4>
                                    <p>Criação de imagens falsas, sons e sensações para enganar e confundir os sentidos.</p>
                                    <button class="btn-details">Ver Detalhes</button>
                                </div>
                                <div class="escola-card">
                                    <div class="escola-icon"><i class="fas fa-shield-alt"></i></div>
                                    <h4 class="text-xl font-cinzel mb-2">Abjuração</h4>
                                    <p>Magias de proteção, barreiras e anulação de outros efeitos mágicos.</p>
                                    <button class="btn-details">Ver Detalhes</button>
                                </div>
                                <div class="escola-card">
                                    <div class="escola-icon"><i class="fas fa-skull"></i></div>
                                    <h4 class="text-xl font-cinzel mb-2">Necromancia</h4>
                                    <p>Magias que manipulam as energias da vida e da morte, incluindo cura e dano vital.</p>
                                    <button class="btn-details">Ver Detalhes</button>
                                </div>
                                <div class="escola-card">
                                    <div class="escola-icon"><i class="fas fa-brain"></i></div>
                                    <h4 class="text-xl font-cinzel mb-2">Encantamento</h4>
                                    <p>Afeta a mente dos seres, manipulando emoções e comportamentos.</p>
                                    <button class="btn-details">Ver Detalhes</button>
                                </div>
                                <div class="escola-card">
                                    <div class="escola-icon"><i class="fas fa-exchange-alt"></i></div>
                                    <h4 class="text-xl font-cinzel mb-2">Transmutação</h4>
                                    <p>Altera as propriedades físicas de objetos e seres, transformando-os ou aprimorando-os.</p>
                                    <button class="btn-details">Ver Detalhes</button>
                                </div>
                                <div class="escola-card">
                                    <div class="escola-icon"><i class="fas fa-book"></i></div>
                                    <h4 class="text-xl font-cinzel mb-2">Adivinhação</h4>
                                    <p>Magias que permitem ao conjurador obter informações, prever o futuro ou descobrir segredos.</p>
                                    <button class="btn-details">Ver Detalhes</button>
                                </div>
                                <div class="escola-card">
                                    <div class="escola-icon"><i class="fas fa-atom"></i></div>
                                    <h4 class="text-xl font-cinzel mb-2">Convocação</h4>
                                    <p>Focada em invocar criaturas, objetos ou energias de outros planos de existência.</p>
                                    <button class="btn-details">Ver Detalhes</button>
                                </div>
                            </div>
                        </div>

                        <div class="elementos-container">
                            <h3 class="text-3xl font-cinzel text-text-light mt-8 mb-8">Elementos Mágicos</h3>
                            <div class="elementos-selector">
                                <button class="elemento-btn active" data-elemento="fire">Fogo <i class="fas fa-fire"></i></button>
                                <button class="elemento-btn" data-elemento="ice">Gelo <i class="fas fa-snowflake"></i></button>
                                <button class="elemento-btn" data-elemento="earth">Terra <i class="fas fa-mountain"></i></button>
                                <button class="elemento-btn" data-elemento="lightning">Elétrico <i class="fas fa-bolt"></i></button>
                                <button class="elemento-btn" data-elemento="dark-magic">Magia Sombria <i class="fas fa-moon"></i></button>
                                <button class="elemento-btn" data-elemento="void">Vazio <i class="fas fa-atom"></i></button>
                                <button class="elemento-btn" data-elemento="light-magic">Magia da Luz <i class="fas fa-sun"></i></button>
                            </div>

                            <div class="elemento-details">
                                <div id="elemento-fire" class="elemento-content active">
                                    <div class="elemento-visual">
                                        <div class="elemento-icon-display fire-icon"><i class="fas fa-fire" style="color: var(--fire-color);"></i></div>
                                    </div>
                                    <div class="elemento-info">
                                        <h4 style="color: var(--fire-color);">Fogo</h4>
                                        <p>O elemento Fogo representa destruição, paixão e energia. Magias de fogo são frequentemente usadas para causar dano explosivo e queimar inimigos.</p>
                                        <h5>Efeitos Comuns:</h5>
                                        <ul>
                                            <li><i class="fas fa-angle-right"></i> Queimadura: Dano contínuo ao longo de turnos.</li>
                                            <li><i class="fas fa-angle-right"></i> Explosão: Dano em área.</li>
                                            <li><i class="fas fa-angle-right"></i> Luz: Iluminação de ambientes.</li>
                                        </ul>
                                    </div>
                                </div>
                                <div id="elemento-ice" class="elemento-content">
                                    <div class="elemento-visual">
                                        <div class="elemento-icon-display ice-icon"><i class="fas fa-snowflake" style="color: var(--ice-color);"></i></div>
                                    </div>
                                    <div class="elemento-info">
                                        <h4 style="color: var(--ice-color);">Gelo</h4>
                                        <p>O elemento Gelo simboliza controle, imobilização e lentidão. Magias de gelo podem congelar, desacelerar e proteger.</p>
                                        <h5>Efeitos Comuns:</h5>
                                        <ul>
                                            <li><i class="fas fa-angle-right"></i> Congelar: Imobiliza ou reduz a velocidade.</li>
                                            <li><i class="fas fa-angle-right"></i> Lentidão: Reduz a velocidade de movimento.</li>
                                            <li><i class="fas fa-angle-right"></i> Barreira de Gelo: Cria obstáculos protetores.</li>
                                        </ul>
                                    </div>
                                </div>
                                <div id="elemento-earth" class="elemento-content">
                                    <div class="elemento-visual">
                                        <div class="elemento-icon-display earth-icon"><i class="fas fa-mountain" style="color: var(--earth-color);"></i></div>
                                    </div>
                                    <div class="elemento-info">
                                        <h4 style="color: var(--earth-color);">Terra</h4>
                                        <p>A Terra é o elemento da resiliência, defesa e estabilidade. Magias de terra são usadas para proteger, fortificar e manipular o terreno.</p>
                                        <h5>Efeitos Comuns:</h5>
                                        <ul>
                                            <li><i class="fas fa-angle-right"></i> Armadura de Pedra: Aumenta a defesa.</li>
                                            <li><i class="fas fa-angle-right"></i> Terremoto: Causa dano em área e pode desequilibrar.</li>
                                            <li><i class="fas fa-angle-right"></i> Crescimento de Plantas: Manipula a vegetação.</li>
                                        </ul>
                                    </div>
                                </div>
                                <div id="elemento-lightning" class="elemento-content">
                                    <div class="elemento-visual">
                                        <div class="elemento-icon-display lightning-icon"><i class="fas fa-bolt" style="color: var(--lightning-color);"></i></div>
                                    </div>
                                    <div class="elemento-info">
                                        <h4 style="color: var(--lightning-color);">Elétrico</h4>
                                        <p>O elemento Elétrico representa velocidade, impacto e paralisia. Magias elétricas causam dano rápido e podem atordoar ou chocar.</p>
                                        <h5>Efeitos Comuns:</h5>
                                        <ul>
                                            <li><i class="fas fa-angle-right"></i> Choque: Causa dano e pode atordoar.</li>
                                            <li><i class="fas fa-angle-right"></i> Reflexo Rápido: Aumenta a velocidade de reação.</li>
                                            <li><i class="fas fa-angle-right"></i> Campo Eletrizado: Cria uma área de dano contínuo.</li>
                                        </ul>
                                    </div>
                                </div>
                                <div id="elemento-dark-magic" class="elemento-content">
                                    <div class="elemento-visual">
                                        <div class="elemento-icon-display dark-magic-icon"><i class="fas fa-moon" style="color: var(--dark-magic-color);"></i></div>
                                    </div>
                                    <div class="elemento-info">
                                        <h4 style="color: var(--dark-magic-color);">Magia Sombria</h4>
                                        <p>A Magia Sombria lida com o enfraquecimento, drenagem e corrupção. Magias sombrias são sutis e perigosas, focadas em debuffs e dano ao longo do tempo.</p>
                                        <h5>Efeitos Comuns:</h5>
                                        <ul>
                                            <li><i class="fas fa-angle-right"></i> Maldição: Reduz atributos ou capacidade.</li>
                                            <li><i class="fas fa-angle-right"></i> Drenar Vida: Absorve energia vital.</li>
                                            <li><i class="fas fa-angle-right"></i> Escuridão: Cria áreas de escuridão mágica.</li>
                                        </ul>
                                    </div>
                                </div>
                                <div id="elemento-void" class="elemento-content">
                                    <div class="elemento-visual">
                                        <div class="elemento-icon-display void-icon"><i class="fas fa-atom" style="color: var(--void-color);"></i></div>
                                    </div>
                                    <div class="elemento-info">
                                        <h4 style="color: var(--void-color);">Vazio</h4>
                                        <p>O Vazio é o elemento da inexistência e desintegração. Magias do vazio podem anular magias, teletransportar e causar dano que ignora defesas.</p>
                                        <h5>Efeitos Comuns:</h5>
                                        <ul>
                                            <li><i class="fas fa-angle-right"></i> Teleporte: Movimento instantâneo.</li>
                                            <li><i class="fas fa-angle-right"></i> Anular Magia: Cancela outros efeitos mágicos.</li>
                                            <li><i class="fas fa-angle-right"></i> Desintegrar: Causa dano massivo ou destrói objetos.</li>
                                        </ul>
                                    </div>
                                </div>
                                <div id="elemento-light-magic" class="elemento-content">
                                    <div class="elemento-visual">
                                        <div class="elemento-icon-display light-magic-icon"><i class="fas fa-sun" style="color: var(--light-magic-color);"></i></div>
                                    </div>
                                    <div class="elemento-info">
                                        <h4 style="color: var(--light-magic-color);">Magia da Luz</h4>
                                        <p>A Magia da Luz representa a purificação, cura e revelação. Magias de luz são poderosas contra o mal e trazem esperança.</p>
                                        <h5>Efeitos Comuns:</h5>
                                        <ul>
                                            <li><i class="fas fa-angle-right"></i> Cura: Restaura pontos de vida.</li>
                                            <li><i class="fas fa-angle-right"></i> Proteção Divina: Concede resistência.</li>
                                            <li><i class="fas fa-angle-right"></i> Revelar: Desmascara ilusões e invisibilidade.</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="status-effects-content" class="tab-content" role="tabpanel" aria-labelledby="tab-status-effects">
                        <h3 class="section-title">Efeitos de Status Expandidos</h3>
                        <p class="section-description">Um catálogo robusto com mais de 30 efeitos detalhados e filtráveis para todas as suas necessidades de combate e roleplay. </p>

                        <div class="efeitos-filter">
                            <button class="filter-btn active" data-filter="all">Todos</button>
                            <button class="filter-btn" data-filter="positivo">Positivos</button>
                            <button class="filter-btn" data-filter="negativo">Negativos</button>
                        </div>

                        <div id="efeitos-grid" class="efeitos-grid">
                            <div class="efeito-card positivo" data-type="positivo">
                                <div class="efeito-icon"><i class="fas fa-shield-alt"></i></div>
                                <h4 class="text-lg font-cinzel text-primary-color mb-2">Protegido</h4>
                                <p class="text-gray-700">Aumenta temporariamente a defesa do alvo, reduzindo o dano recebido.</p>
                                <div class="efeito-details-info">
                                    <span><i class="fas fa-tag"></i> Defesa</span>
                                    <span><i class="fas fa-clock"></i> 3 Turnos</span>
                                </div>
                            </div>
                            <div class="efeito-card negativo" data-type="negativo">
                                <div class="efeito-icon"><i class="fas fa-skull-crossbones"></i></div>
                                <h4 class="text-lg font-cinzel text-primary-color mb-2">Envenenado</h4>
                                <p class="text-gray-700">Causa dano contínuo ao longo do tempo e pode reduzir a eficácia de curas.</p>
                                <div class="efeito-details-info">
                                    <span><i class="fas fa-tag"></i> Dano/Debuff</span>
                                    <span><i class="fas fa-clock"></i> 5 Turnos</span>
                                </div>
                            </div>
                            <div class="efeito-card positivo" data-type="positivo">
                                <div class="efeito-icon"><i class="fas fa-bolt"></i></div>
                                <h4 class="text-lg font-cinzel text-primary-color mb-2">Acelerado</h4>
                                <p class="text-gray-700">Concede um turno adicional ou aumenta a velocidade de movimento.</p>
                                <div class="efeito-details-info">
                                    <span><i class="fas fa-tag"></i> Movimento</span>
                                    <span><i class="fas fa-clock"></i> 2 Turnos</span>
                                </div>
                            </div>
                            <div class="efeito-card negativo" data-type="negativo">
                                <div class="efeito-icon"><i class="fas fa-shoe-prints"></i></div>
                                <h4 class="text-lg font-cinzel text-primary-color mb-2">Lento</h4>
                                <p class="text-gray-700">Reduz a velocidade de movimento e pode impedir certas ações.</p>
                                <div class="efeito-details-info">
                                    <span><i class="fas fa-tag"></i> Movimento</span>
                                    <span><i class="fas fa-clock"></i> 3 Turnos</span>
                                </div>
                            </div>
                            <div class="efeito-card positivo" data-type="positivo">
                                <div class="efeito-icon"><i class="fas fa-hand-holding-heart"></i></div>
                                <h4 class="text-lg font-cinzel text-primary-color mb-2">Curado</h4>
                                <p class="text-gray-700">Restaurou pontos de vida, pode ser instantâneo ou por turno.</p>
                                <div class="efeito-details-info">
                                    <span><i class="fas fa-tag"></i> Cura</span>
                                    <span><i class="fas fa-clock"></i> Instantâneo</span>
                                </div>
                            </div>
                            <div class="efeito-card negativo" data-type="negativo">
                                <div class="efeito-icon"><i class="fas fa-dizzy"></i></div>
                                <h4 class="text-lg font-cinzel text-primary-color mb-2">Confuso</h4>
                                <p class="text-gray-700">O alvo age aleatoriamente ou não consegue realizar ações claras.</p>
                                <div class="efeito-details-info">
                                    <span><i class="fas fa-tag"></i> Controle</span>
                                    <span><i class="fas fa-clock"></i> 1-2 Turnos</span>
                                </div>
                            </div>
                            <div class="efeito-card positivo" data-type="positivo">
                                <div class="efeito-icon"><i class="fas fa-eye"></i></div>
                                <h4 class="text-lg font-cinzel text-primary-color mb-2">Visão Aprimorada</h4>
                                <p class="text-gray-700">Concede visão na escuridão ou desmascara ilusões.</p>
                                <div class="efeito-details-info">
                                    <span><i class="fas fa-tag"></i> Utilidade</span>
                                    <span><i class="fas fa-clock"></i> 5 Turnos</span>
                                </div>
                            </div>
                            <div class="efeito-card negativo" data-type="negativo">
                                <div class="efeito-icon"><i class="fas fa-eye-slash"></i></div>
                                <h4 class="text-lg font-cinzel text-primary-color mb-2">Cegado</h4>
                                <p class="text-gray-700">O alvo tem dificuldade de ver, causando desvantagem em ataques e testes.</p>
                                <div class="efeito-details-info">
                                    <span><i class="fas fa-tag"></i> Debuff</span>
                                    <span><i class="fas fa-clock"></i> 1-3 Turnos</span>
                                </div>
                            </div>
                            <div class="efeito-card positivo" data-type="positivo">
                                <div class="efeito-icon"><i class="fas fa-hand-holding-usd"></i></div>
                                <h4 class="text-lg font-cinzel text-primary-color mb-2">Sorte</h4>
                                <p class="text-gray-700">Aumenta a chance de sucesso em testes ou rolagens de dano.</p>
                                <div class="efeito-details-info">
                                    <span><i class="fas fa-tag"></i> Bônus</span>
                                    <span><i class="fas fa-clock"></i> 2 Turnos</span>
                                </div>
                            </div>
                            <div class="efeito-card negativo" data-type="negativo">
                                <div class="efeito-icon"><i class="fas fa-times-circle"></i></div>
                                <h4 class="text-lg font-cinzel text-primary-color mb-2">Azar</h4>
                                <p class="text-gray-700">Reduz a chance de sucesso em testes ou rolagens de dano.</p>
                                <div class="efeito-details-info">
                                    <span><i class="fas fa-tag"></i> Penalidade</span>
                                    <span><i class="fas fa-clock"></i> 2 Turnos</span>
                                </div>
                            </div>
                            <div class="efeito-card positivo" data-type="positivo">
                                <div class="efeito-icon"><i class="fas fa-fist-raised"></i></div>
                                <h4 class="text-lg font-cinzel text-primary-color mb-2">Força Aprimorada</h4>
                                <p class="text-gray-700">Aumenta temporariamente a força física e o dano de ataques corpo a corpo.</p>
                                <div class="efeito-details-info">
                                    <span><i class="fas fa-tag"></i> Buff</span>
                                    <span><i class="fas fa-clock"></i> 3 Turnos</span>
                                </div>
                            </div>
                            <div class="efeito-card negativo" data-type="negativo">
                                <div class="efeito-icon"><i class="fas fa-hand-rock"></i></div>
                                <h4 class="text-lg font-cinzel text-primary-color mb-2">Fraqueza</h4>
                                <p class="text-gray-700">Reduz a força e a capacidade de causar dano físico.</p>
                                <div class="efeito-details-info">
                                    <span><i class="fas fa-tag"></i> Debuff</span>
                                    <span><i class="fas fa-clock"></i> 4 Turnos</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="magic-creation" class="section criacao-section">
            <div class="container">
                <h2 class="section-title">Criação de Magia Aprimorada </h2>
                <p class="section-description">Crie magias poderosas e personalizadas com nosso assistente passo a passo. </p>

                <div class="criacao-wizard">
                    <div class="wizard-progress">
                        <div class="progress-step active" data-step="1">
                            <div class="step-number">1</div>
                            <div class="step-label">Nome & Desc.</div>
                        </div>
                        <div class="progress-step" data-step="2">
                            <div class="step-number">2</div>
                            <div class="step-label">Tipo & Escola</div>
                        </div>
                        <div class="progress-step" data-step="3">
                            <div class="step-number">3</div>
                            <div class="step-label">Alcance & Duração</div>
                        </div>
                        <div class="progress-step" data-step="4">
                            <div class="step-number">4</div>
                            <div class="step-label">Balanceamento & Aparência</div>
                        </div>
                        <div class="progress-step" data-step="5">
                            <div class="step-number">5</div>
                            <div class="step-label">Efeitos de Status</div>
                        </div>
                        <div class="progress-step" data-step="6">
                            <div class="step-number">6</div>
                            <div class="step-label">Revisar & Salvar</div>
                        </div>
                    </div>

                    <div class="wizard-content">
                        <div id="wizard-step-1" class="wizard-step active">
                            <h3>Passo 1: Nome e Descrição</h3>
                            <p>Defina a identidade da sua magia com um nome cativante e uma descrição detalhada de seus efeitos e lore. </p>
                            <div class="form-group">
                                <label for="magic-name">Nome da Magia:</label>
                                <input type="text" id="magic-name" placeholder="Ex: Bola de Fogo Arcana" required>
                            </div>
                            <div class="form-group">
                                <label for="magic-description">Descrição:</label>
                                <textarea id="magic-description" placeholder="Descreva os efeitos da magia e sua lore."></textarea>
                            </div>
                            <div class="wizard-buttons">
                                <button class="btn btn-secondary disabled" disabled>Anterior</button>
                                <button class="btn btn-primary" onclick="nextStep()">Próximo</button>
                            </div>
                        </div>

                        <div id="wizard-step-2" class="wizard-step">
                            <h3>Passo 2: Tipo e Escola </h3>
                            <p>Classifique sua magia como ataque, suporte ou controle, e atribua-a a uma escola de magia. </p>

                            <div class="form-group">
                                <label>Tipo de Magia:</label>
                                <div class="tipo-selector" id="magic-type-selector">
                                    <div class="tipo-option" data-value="Ataque">
                                        <div class="tipo-icon" style="background-color: rgba(var(--danger-rgb), 0.2); color: var(--danger-color);"><i class="fas fa-bomb"></i></div>
                                        <h4>Ataque</h4>
                                        <p>Focada em dano e efeitos negativos.</p>
                                    </div>
                                    <div class="tipo-option" data-value="Suporte">
                                        <div class="tipo-icon" style="background-color: rgba(var(--success-rgb), 0.2); color: var(--success-color);"><i class="fas fa-heart-pulse"></i></div>
                                        <h4>Suporte</h4>
                                        <p>Cura, bônus e utilidade.</p>
                                    </div>
                                    <div class="tipo-option" data-value="Controle">
                                        <div class="tipo-icon" style="background-color: rgba(var(--info-rgb), 0.2); color: var(--info-color);"><i class="fas fa-brain"></i></div>
                                        <h4>Controle</h4>
                                        <p>Manipula o campo de batalha e inimigos.</p>
                                    </div>
                                </div>
                                <input type="hidden" id="magic-type" required>
                            </div>

                            <div class="form-group">
                                <label for="magic-school">Escola de Magia:</label>
                                <select id="magic-school" class="w-full p-3 rounded bg-gray-700 border-gray-600 text-white" required>
                                    <option value="">Selecione a Escola</option>
                                     <option value="Evocação">elementais</option>
                                    <option value="Evocação">Evocação</option>
                                    <option value="Ilusão">Ilusão</option>
                                    <option value="Abjuração">Abjuração</option>
                                    <option value="Necromancia">Necromancia</option>
                                    <option value="Encantamento">Encantamento</option>
                                    <option value="Transmutação">Transmutação</option>
                                    <option value="Adivinhação">Adivinhação</option>
                                    <option value="Convocação">Convocação</option>
                                </select>
                            </div>

                            <div class="wizard-buttons">
                                <button class="btn btn-secondary" onclick="prevStep()">Anterior</button>
                                <button class="btn btn-primary" onclick="nextStep()">Próximo</button>
                            </div>
                        </div>

                        <div id="wizard-step-3" class="wizard-step">
                            <h3>Passo 3: Alcance, Área e Duração </h3>
                            <p>Configure a área de efeito, o alcance e a duração do feitiço, agora com opções de seleção múltipla para maior versatilidade. </p>

                            <div class="form-group">
                                <label for="magic-range">Alcance:</label>
                                <select id="magic-range" multiple class="w-full p-3 rounded bg-gray-700 border-gray-600 text-white" required>
                                    <option value="Toque">Toque</option>
                                    <option value="3m">3 metros</option>
                                    <option value="9m">9 metros</option>
                                    <option value="18m">18 metros</option>
                                    <option value="36m">36 metros</option>
                                    <option value="60m">60 metros</option>
                                    <option value="100m">100 metros</option>
                                    <option value="Ilimitado">Ilimitado</option>
                                </select>
                                <p class="text-xs text-gray-400 mt-1">Ctrl+clique (ou Cmd+clique) para selecionar múltiplos.</p>
                            </div>

                            <div class="form-group">
                                <label for="magic-area">Área de Efeito:</label>
                                <select id="magic-area" multiple class="w-full p-3 rounded bg-gray-700 border-gray-600 text-white" required>
                                    <option value="Único">Único Alvo</option>
                                    <option value="Cone 3m">Cone (3m)</option>
                                    <option value="Cilindro 3m">Cilindro (3m raio)</option>
                                    <option value="Linha 9m">Linha (9m)</option>
                                    <option value="Esfera 3m">Esfera (3m raio)</option>
                                    <option value="Cubo 6m">Cubo (6m lado)</option>
                                    <option value="Self">Self</option>
                                </select>
                                <p class="text-xs text-gray-400 mt-1">Ctrl+clique (ou Cmd+clique) para selecionar múltiplos.</p>
                            </div>

                            <div class="form-group">
                                <label for="magic-duration">Duração:</label>
                                <select id="magic-duration" multiple class="w-full p-3 rounded bg-gray-700 border-gray-600 text-white" required>
                                    <option value="Instantâneo">Instantâneo</option>
                                    <option value="1 Rodada">1 Rodada</option>
                                    <option value="3 Rodadas">3 Rodadas</option>
                                    <option value="5 Rodadas">5 Rodadas</option>
                                    <option value="1 Minuto">1 Minuto</option>
                                    <option value="10 Minutos">10 Minutos</option>
                                    <option value="1 Hora">1 Hora</option>
                                    <option value="24 Horas">24 Horas</option>
                                    <option value="Permanente">Permanente</option>
                                    <option value="Concentração">Concentração (até 1 min)</option>
                                </select>
                                <p class="text-xs text-gray-400 mt-1">Ctrl+clique (ou Cmd+clique) para selecionar múltiplos.</p>
                            </div>

                            <div class="wizard-buttons">
                                <button class="btn btn-secondary" onclick="prevStep()">Anterior</button>
                                <button class="btn btn-primary" onclick="nextStep()">Próximo</button>
                            </div>
                        </div>

                        <div id="wizard-step-4" class="wizard-step">
                            <h3>Passo 4: Balanceamento e Aparência </h3>
                            <p>Ajuste o cooldown e os pontos de ação, e personalize os efeitos visuais, cores e formas da sua magia. </p>

                            <div class="form-group">
                                <label for="magic-cost-pa">Custo de Pontos de Ação (PA):</label>
                                <input type="number" id="magic-cost-pa" min="1" max="5" value="1" required>
                            </div>

                            <div class="form-group">
                                <label for="magic-cooldown">Cooldown (Turnos):</label>
                                <input type="number" id="magic-cooldown" min="0" value="0" required>
                                <p class="text-xs text-gray-400 mt-1">Magias poderosas exigem maior custo de PA ou cooldown. </p>
                            </div>

                            <div class="form-group">
                                <label for="magic-visual-color">Cor Visual:</label>
                                <input type="color" id="magic-visual-color" value="#8a4fff" class="w-full h-12 rounded-lg cursor-pointer">
                                <p class="text-xs text-gray-400 mt-1">Personalize para imersão extra. </p>
                            </div>

                            <div class="form-group">
                                <label for="magic-visual-icon">Ícone Visual (Font Awesome):</label>
                                <input type="text" id="magic-visual-icon" placeholder="Ex: fas fa-fire" value="fas fa-hat-wizard" required>
                                <p class="text-xs text-gray-400 mt-1">Use classes de ícones Font Awesome (ex: fas fa-fire, fas fa-shield-alt).</p>
                            </div>

                            <div class="wizard-buttons">
                                <button class="btn btn-secondary" onclick="prevStep()">Anterior</button>
                                <button class="btn btn-primary" onclick="nextStep()">Próximo</button>
                            </div>
                        </div>

                        <div id="wizard-step-5" class="wizard-step">
                            <h3>Passo 5: Efeitos de Status (Opcional) </h3>
                            <p>Adicione efeitos de status positivos ou negativos que sua magia pode aplicar, escolhendo do catálogo expandido. </p>

                            <div class="form-group">
                                <label for="status-effect-select">Adicionar Efeito:</label>
                                <select id="status-effect-select" class="w-full p-3 rounded bg-gray-700 border-gray-600 text-white">
                                    <option value="">Selecione um efeito</option>
                                    </select>
                                <button class="btn btn-primary mt-3" onclick="addSelectedEffect()">Adicionar Efeito</button>
                            </div>

                            <div class="form-group">
                                <label>Efeitos Selecionados:</label>
                                <div id="selected-effects-list" class="selected-effects-list">
                                    <p class="text-gray-400" id="no-effects-message">Nenhum efeito selecionado.</p>
                                </div>
                            </div>

                            <div class="wizard-buttons">
                                <button class="btn btn-secondary" onclick="prevStep()">Anterior</button>
                                <button class="btn btn-primary" onclick="nextStep()">Próximo</button>
                            </div>
                        </div>

                        <div id="wizard-step-6" class="wizard-step">
                            <h3>Passo 6: Revisar e Salvar </h3>
                            <p>Finalize sua criação, revise todos os detalhes e salve sua magia na biblioteca para uso futuro. </p>

                            <div class="magia-preview">
                                <div class="preview-card">
                                    <div class="preview-header">
                                        <h4 id="preview-name">Nome da Magia</h4>
                                        <span id="preview-type-school">Tipo | Escola</span>
                                    </div>
                                    <div class="preview-body">
                                        <p id="preview-description" class="text-sm">Descrição da magia...</p>
                                        <div class="preview-stats-grid">
                                            <div class="preview-stat-item"><strong>Alcance:</strong> <span id="preview-range"></span></div>
                                            <div class="preview-stat-item"><strong>Área:</strong> <span id="preview-area"></span></div>
                                            <div class="preview-stat-item"><strong>Duração:</strong> <span id="preview-duration"></span></div>
                                        </div>
                                        <div class="preview-cost-display">
                                            <div class="pa-cost-display" id="preview-pa-cost-display">
                                                <span class="pa-value-display" id="preview-pa-value">1</span>
                                                <span class="pa-label-display">PA</span>
                                            </div>
                                            <div class="preview-cooldown-display">
                                                <strong>Cooldown:</strong> <span id="preview-cooldown">0 Turnos</span>
                                            </div>
                                        </div>
                                        <div class="preview-effects-display">
                                            <h5>Efeitos Aplicados:</h5>
                                            <p id="preview-effects-list">Nenhum</p>
                                        </div>
                                        <div class="flex justify-center mt-4">
                                            <div id="preview-icon-display" class="w-24 h-24 rounded-full flex items-center justify-center text-4xl" style="background-color: rgba(var(--primary-rgb), 0.2); color: var(--text-light);">
                                                <i class="fas fa-hat-wizard"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="wizard-buttons">
                                <button class="btn btn-secondary" onclick="prevStep()">Anterior</button>
                                <button class="btn btn-primary" onclick="saveMagic()">Salvar Magia</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="library" class="section bg-light">
            <div class="container">
                <h2 class="section-title">Biblioteca de Magias </h2>
                <p class="section-description">Explore sua coleção de magias salvas. Utilize filtros para encontrar feitiços por tipo, escola ou custo. </p>

                <div class="library-filters">
                    <input type="text" id="library-search" placeholder="Buscar por nome...">
                    <select id="library-filter-type">
                        <option value="all">Todos os Tipos</option>
                        <option value="Ataque">Ataque</option>
                        <option value="Suporte">Suporte</option>
                        <option value="Controle">Controle</option>
                    </select>
                    <select id="library-filter-school">
                        <option value="all">Todas as Escolas</option>
                        <option value="Evocação">Evocação</option>
                        <option value="Ilusão">Ilusão</option>
                        <option value="Abjuração">Abjuração</option>
                        <option value="Necromancia">Necromancia</option>
                        <option value="Encantamento">Encantamento</option>
                        <option value="Transmutação">Transmutação</option>
                        <option value="Adivinhação">Adivinhação</option>
                        <option value="Convocação">Convocação</option>
                    </select>
                    <button class="btn btn-secondary" onclick="openImportModal()">
                        <i class="fas fa-upload"></i> Importar Magia 
                    </button>
                    <button class="btn btn-primary" onclick="exportAllMagics()">
                        <i class="fas fa-download"></i> Exportar Todas
                    </button>
                </div>

                <div id="magic-library-grid" class="library-grid">
                    <p class="text-center text-gray-500 col-span-full" id="no-magics-message">Nenhuma magia salva ainda. Crie uma!</p>
                    </div>
            </div>
        </section>

        <section id="character-sheet" class="section ficha-section">
            <div class="container">
                <h2 class="section-title">Ficha de Personagem </h2>
                <p class="section-description">Gerencie seus personagens. Crie novos ou carregue existentes para suas campanhas. </p>

                <div class="ficha-container">
                    <h3 class="ficha-section-title">Informações Básicas <span class="section-divider"></span></h3>
                    <div class="ficha-row">
                        <div class="form-group-ficha col-2">
                            <label for="char-name">Nome do Personagem:</label>
                            <input type="text" id="char-name" placeholder="Nome do seu herói">
                        </div>
                        <div class="form-group-ficha col-2">
                            <label for="char-class">Classe:</label>
                            <input type="text" id="char-class" placeholder="Mago, Guerreiro, etc.">
                        </div>
                        <div class="form-group-ficha col-2">
                            <label for="char-race">Raça:</label>
                            <input type="text" id="char-race" placeholder="Humano, Elfo, Anão, etc.">
                        </div>
                        <div class="form-group-ficha col-2">
                            <label for="char-level">Nível:</label>
                            <input type="number" id="char-level" min="1" value="1">
                        </div>
                    </div>

                    <h3 class="ficha-section-title">Atributos <span class="section-divider"></span></h3>
                    <div class="atributos-container">
                        <div class="atributo-card">
                            <div class="atributo-nome">Força</div>
                            <div class="atributo-valor">
                                <input type="number" id="attr-str" value="10" min="1" max="30">
                            </div>
                            <div class="atributo-mod" id="mod-str">+0</div>
                        </div>
                        <div class="atributo-card">
                            <div class="atributo-nome">Destreza</div>
                            <div class="atributo-valor">
                                <input type="number" id="attr-dex" value="10" min="1" max="30">
                            </div>
                            <div class="atributo-mod" id="mod-dex">+0</div>
                        </div>
                        <div class="atributo-card">
                            <div class="atributo-nome">Constituição</div>
                            <div class="atributo-valor">
                                <input type="number" id="attr-con" value="10" min="1" max="30">
                            </div>
                            <div class="atributo-mod" id="mod-con">+0</div>
                        </div>
                        <div class="atributo-card">
                            <div class="atributo-nome">Inteligência</div>
                            <div class="atributo-valor">
                                <input type="number" id="attr-int" value="10" min="1" max="30">
                            </div>
                            <div class="atributo-mod" id="mod-int">+0</div>
                        </div>
                        <div class="atributo-card">
                            <div class="atributo-nome">Sabedoria</div>
                            <div class="atributo-valor">
                                <input type="number" id="attr-wis" value="10" min="1" max="30">
                            </div>
                            <div class="atributo-mod" id="mod-wis">+0</div>
                        </div>
                        <div class="atributo-card">
                            <div class="atributo-nome">Carisma</div>
                            <div class="atributo-valor">
                                <input type="number" id="attr-cha" value="10" min="1" max="30">
                            </div>
                            <div class="atributo-mod" id="mod-cha">+0</div>
                        </div>
                    </div>

                    <h3 class="ficha-section-title">Recursos de Combate <span class="section-divider"></span></h3>
                    <div class="recursos-container">
                        <div class="recurso-card">
                            <div class="recurso-nome">Pontos de Vida (PV)</div>
                            <div class="recurso-valor">
                                <input type="number" id="hp-current" value="10" min="0"> /
                                <input type="number" id="hp-max" value="10" min="1">
                            </div>
                        </div>
                        <div class="recurso-card">
                            <div class="recurso-nome">Pontos de Mana (PM)</div>
                            <div class="recurso-valor">
                                <input type="number" id="mp-current" value="5" min="0"> /
                                <input type="number" id="mp-max" value="5" min="1">
                            </div>
                        </div>
                        <div class="recurso-card">
                            <div class="recurso-nome">Pontos de Ação (PA)</div>
                            <div class="recurso-valor">
                                <input type="number" id="pa-char-current" value="3" min="0" max="5"> / 5
                            </div>
                        </div>
                        <div class="recurso-card">
                            <div class="recurso-nome">Classe de Armadura (CA)</div>
                            <div class="recurso-valor">
                                <input type="number" id="ac-value" value="10" min="0">
                            </div>
                        </div>
                        <div class="recurso-card">
                            <div class="recurso-nome">Iniciativa</div>
                            <div class="recurso-valor">
                                <input type="number" id="initiative-value" value="0">
                            </div>
                        </div>
                    </div>

                    <h3 class="ficha-section-title">Especializações Mágicas <span class="section-divider"></span></h3>
                    <p class="text-gray-700 mb-4">Escolha especializações que reduzem custos de magia ou oferecem bônus. </p>
                    <div class="especializacoes-container">
                        <div class="especializacao-grupo">
                            <h4 class="font-cinzel">Domínio Elemental</h4>
                            <div class="especializacao-item">
                                <input type="checkbox" id="spec-fire" data-school="Evocação" data-element="Fogo">
                                <label for="spec-fire">Mestre do Fogo</label>
                                <span>(-1 PA em magias de Fogo)</span>
                            </div>
                            <div class="especializacao-item">
                                <input type="checkbox" id="spec-ice" data-school="Evocação" data-element="Gelo">
                                <label for="spec-ice">Mestre do Gelo</label>
                                <span>(-1 PA em magias de Gelo)</span>
                            </div>
                            <div class="especializacao-item">
                                <input type="checkbox" id="spec-lightning" data-school="Evocação" data-element="Elétrico">
                                <label for="spec-lightning">Mestre do Relâmpago</label>
                                <span>(-1 PA em magias Elétricas)</span>
                            </div>
                        </div>
                        <div class="especializacao-grupo">
                            <h4 class="font-cinzel">Proficiência Arcana</h4>
                            <div class="especializacao-item">
                                <input type="checkbox" id="spec-abjuration" data-school="Abjuração">
                                <label for="spec-abjuration">Escudo Arcano Aprimorado</label>
                                <span>(-1 PA em magias de Abjuração)</span>
                            </div>
                            <div class="especializacao-item">
                                <input type="checkbox" id="spec-necromancy" data-school="Necromancia">
                                <label for="spec-necromancy">Toque Necrótico</label>
                                <span>(-1 PA em magias de Necromancia)</span>
                            </div>
                        </div>
                    </div>

                    <h3 class="ficha-section-title">Magias do Personagem <span class="section-divider"></span></h3>
                    <div class="flex justify-end mb-4">
                        <button class="btn btn-primary" onclick="openAddMagicToCharacterModal()">
                            <i class="fas fa-plus"></i> Adicionar Magia
                        </button>
                    </div>
                    <div id="magias-personagem-grid" class="magias-personagem-grid">
                        <p class="text-center text-gray-500 col-span-full" id="no-char-magics-message">Nenhuma magia adicionada ao personagem.</p>
                        </div>

                    <div class="flex justify-end mt-8 gap-4">
                        <button class="btn btn-secondary" onclick="loadCharacter()">
                            <i class="fas fa-upload"></i> Carregar Ficha
                        </button>
                        <button class="btn btn-primary" onclick="saveCharacter()">
                            <i class="fas fa-save"></i> Salvar Ficha
                        </button>
                        <button class="btn btn-danger" onclick="resetCharacterSheet()">
                            <i class="fas fa-trash"></i> Resetar Ficha
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <section id="about" class="section bg-dark">
            <div class="container text-center">
                <h2 class="section-title">Sobre o Sistema de Magia RPG</h2>
                <p class="section-description text-gray-300">Este sistema de magia foi desenvolvido para aprimorar suas sessões de RPG de fantasia medieval, focado em usabilidade e personalização.</p>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mt-8 text-left">
                    <div class="bg-gray-800 p-6 rounded-lg shadow-lg">
                        <h3 class="text-xl font-cinzel text-accent-color mb-3"><i class="fas fa-star mr-2"></i> Missão</h3>
                        <p class="text-gray-400">Nossa missão é fornecer ferramentas digitais intuitivas e ricas em recursos para jogadores e mestres de RPG, elevando a experiência de jogo.</p>
                    </div>
                    <div class="bg-gray-800 p-6 rounded-lg shadow-lg">
                        <h3 class="text-xl font-cinzel text-accent-color mb-3"><i class="fas fa-code mr-2"></i> Tecnologia</h3>
                        <p class="text-gray-400">Desenvolvido com HTML, CSS (TailwindCSS) e JavaScript puro, garantindo leveza e compatibilidade offline. </p>
                    </div>
                    <div class="bg-gray-800 p-6 rounded-lg shadow-lg">
                        <h3 class="text-xl font-cinzel text-accent-color mb-3"><i class="fas fa-envelope mr-2"></i> Contato</h3>
                        <p class="text-gray-400">Para suporte, sugestões ou feedback, entre em contato em <a href="mailto:admirador@gostoso.com" class="text-accent-color hover:underline">admirador@gostoso.com</a>. </p>
                    </div>
                </div>
                <p class="text-gray-500 mt-8 text-sm">Feito com paixão por RPG. </p>
            </div>
        </section>
    </main>

    <footer class="bg-primary-color text-text-light py-8">
        <div class="container text-center">
            <p>&copy; 2025 Sistema de Magia RPG. Todos os direitos reservados.</p>
            <div class="flex justify-center gap-4 mt-4">
                <a href="#" class="text-text-light hover:text-accent-color transition"><i class="fab fa-facebook-f"></i></a>
                <a href="#" class="text-text-light hover:text-accent-color transition"><i class="fab fa-twitter"></i></a>
                <a href="#" class="text-text-light hover:text-accent-color transition"><i class="fab fa-instagram"></i></a>
            </div>
        </div>
    </footer>

    <div id="import-modal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeImportModal()">&times;</span>
            <h3>Importar Magia </h3>
            <p>Cole o código de compartilhamento da magia abaixo ou faça upload de um arquivo JSON. </p>
            <div class="form-group">
                <label for="import-magic-code">Código de Compartilhamento (JSON):</label>
                <textarea id="import-magic-code" placeholder="Cole o código JSON da magia aqui..."></textarea>
            </div>
            <div class="form-group">
                <label for="import-json-file">Ou Carregar Arquivo JSON:</label>
                <input type="file" id="import-json-file" accept=".json" class="w-full text-white file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-violet-50 file:text-violet-700 hover:file:bg-violet-100">
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeImportModal()">Cancelar</button>
                <button class="btn btn-primary" onclick="importMagicFromModal()">Importar</button>
            </div>
        </div>
    </div>

    <div id="share-modal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeShareModal()">&times;</span>
            <h3>Compartilhar Magia </h3>
            <p>Copie o código abaixo ou exporte como JSON para compartilhar esta magia. </p>
            <div class="form-group">
                <label for="share-magic-code">Código de Compartilhamento (JSON):</label>
                <textarea id="share-magic-code" readonly onclick="this.select()"></textarea>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="copyShareCode()">Copiar Código</button>
                <button class="btn btn-primary" id="export-magic-json-btn">Exportar JSON</button>
            </div>
        </div>
    </div>

    <div id="add-magic-to-char-modal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeAddMagicToCharacterModal()">&times;</span>
            <h3>Adicionar Magia à Ficha </h3>
            <p>Selecione uma magia da sua biblioteca para adicionar à ficha do personagem.</p>
            <div class="form-group">
                <label for="magic-to-add-select">Magia:</label>
                <select id="magic-to-add-select" class="w-full p-3 rounded bg-gray-700 border-gray-600 text-white">
                    <option value="">Selecione uma magia</option>
                    </select>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeAddMagicToCharacterModal()">Cancelar</button>
                <button class="btn btn-primary" onclick="addMagicToCharacter()">Adicionar</button>
            </div>
        </div>
    </div>


    <script>
        // --- Global State ---
        let currentStep = 1;
        const totalSteps = 6;
        let currentPA = 3;
        const maxPA = 5;

        // Magic Creation Form Data
        let newMagic = {
            id: '',
            name: '',
            description: '',
            type: '',
            school: '',
            range: [],
            area: [],
            duration: [],
            costPA: 1,
            cooldown: 0,
            visualColor: '#8a4fff',
            visualIcon: 'fas fa-hat-wizard',
            effects: []
        };

        // Static Data (for simplicity, could be loaded from JSON)
        const allStatusEffects = [
            { id: 'protegido', name: 'Protegido', description: 'Aumenta temporariamente a defesa do alvo, reduzindo o dano recebido.', type: 'positivo', category: 'Defesa', duration: '3 Turnos', icon: 'fas fa-shield-alt' },
            { id: 'envenenado', name: 'Envenenado', description: 'Causa dano contínuo ao longo do tempo e pode reduzir a eficácia de curas.', type: 'negativo', category: 'Dano/Debuff', duration: '5 Turnos', icon: 'fas fa-skull-crossbones' },
            { id: 'acelerado', name: 'Acelerado', description: 'Concede um turno adicional ou aumenta a velocidade de movimento.', type: 'positivo', category: 'Movimento', duration: '2 Turnos', icon: 'fas fa-bolt' },
            { id: 'lento', name: 'Lento', description: 'Reduz a velocidade de movimento e pode impedir certas ações.', type: 'negativo', category: 'Movimento', duration: '3 Turnos', icon: 'fas fa-shoe-prints' },
            { id: 'curado', name: 'Curado', description: 'Restaurou pontos de vida, pode ser instantâneo ou por turno.', type: 'positivo', category: 'Cura', duration: 'Instantâneo', icon: 'fas fa-hand-holding-heart' },
            { id: 'confuso', name: 'Confuso', description: 'O alvo age aleatoriamente ou não consegue realizar ações claras.', type: 'negativo', category: 'Controle', duration: '1-2 Turnos', icon: 'fas fa-dizzy' },
            { id: 'visao-aprimorada', name: 'Visão Aprimorada', description: 'Concede visão na escuridão ou desmascara ilusões.', type: 'positivo', category: 'Utilidade', duration: '5 Turnos', icon: 'fas fa-eye' },
            { id: 'cegado', name: 'Cegado', description: 'O alvo tem dificuldade de ver, causando desvantagem em ataques e testes.', type: 'negativo', category: 'Debuff', duration: '1-3 Turnos', icon: 'fas fa-eye-slash' },
            { id: 'sorte', name: 'Sorte', description: 'Aumenta a chance de sucesso em testes ou rolagens de dano.', type: 'positivo', category: 'Bônus', duration: '2 Turnos', icon: 'fas fa-hand-holding-usd' },
            { id: 'azar', name: 'Azar', description: 'Reduz a chance de sucesso em testes ou rolagens de dano.', type: 'negativo', category: 'Penalidade', duration: '2 Turnos', icon: 'fas fa-times-circle' },
            { id: 'forca-aprimorada', name: 'Força Aprimorada', description: 'Aumenta temporariamente a força física e o dano de ataques corpo a corpo.', type: 'positivo', category: 'Buff', duration: '3 Turnos', icon: 'fas fa-fist-raised' },
            { id: 'fraqueza', name: 'Fraqueza', description: 'Reduz a força e a capacidade de causar dano físico.', type: 'negativo', category: 'Debuff', duration: '4 Turnos', icon: 'fas fa-hand-rock' },
            { id: 'silenciado', name: 'Silenciado', description: 'Impede o alvo de usar magias com componente verbal.', type: 'negativo', category: 'Controle', duration: '1 Rodada', icon: 'fas fa-comment-slash' },
            { id: 'regeneracao', name: 'Regeneração', description: 'Recupera pontos de vida no início de cada turno.', type: 'positivo', category: 'Cura', duration: '3 Turnos', icon: 'fas fa-recycle' },
            { id: 'medo', name: 'Medo', description: 'O alvo tenta fugir da fonte do medo.', type: 'negativo', category: 'Controle', duration: '2 Turnos', icon: 'fas fa-ghost' },
            { id: 'inspiracao', name: 'Inspiração', description: 'Concede bônus em testes de perícia ou ataques.', type: 'positivo', category: 'Buff', duration: '1 Minuto', icon: 'fas fa-lightbulb' },
            { id: 'exaustao', name: 'Exaustão', description: 'Reduz a velocidade e causa desvantagem em testes de atributo.', type: 'negativo', category: 'Debuff', duration: 'Até Descanso Longo', icon: 'fas fa-tired' },
            { id: 'invulneravel', name: 'Invulnerável', description: 'Imune a todo o dano por um curto período.', type: 'positivo', category: 'Defesa', duration: '1 Rodada', icon: 'fas fa-cubes' },
            { id: 'atordoado', name: 'Atordoado', description: 'Não pode agir, move-se ou reagir.', type: 'negativo', category: 'Controle', duration: '1 Turno', icon: 'fas fa-star-half-alt' },
            { id: 'resistencia', name: 'Resistência', description: 'Reduz pela metade o dano de um tipo específico (ex: fogo, físico).', type: 'positivo', category: 'Defesa', duration: 'Concentração', icon: 'fas fa-shield-virus' },
            { id: 'vulnerabilidade', name: 'Vulnerabilidade', description: 'Dano de um tipo específico é duplicado (ex: fogo, físico).', type: 'negativo', category: 'Dano/Debuff', duration: '1 Minuto', icon: 'fas fa-exclamation-triangle' },
            { id: 'invisivel', name: 'Invisível', description: 'Não pode ser visto sem meios mágicos ou percepção aprimorada.', type: 'positivo', category: 'Utilidade', duration: 'Concentração', icon: 'fas fa-eye-slash' },
            { id: 'paralisado', name: 'Paralisado', description: 'Totalmente imobilizado e indefeso.', type: 'negativo', category: 'Controle', duration: 'Até quebra de Concentração', icon: 'fas fa-chain' },
            { id: 'vantagem', name: 'Vantagem', description: 'Rola dois d20 e usa o resultado maior.', type: 'positivo', category: 'Bônus', duration: '1 Rodada', icon: 'fas fa-chevron-up' },
            { id: 'desvantagem', name: 'Desvantagem', description: 'Rola dois d20 e usa o resultado menor.', type: 'negativo', category: 'Penalidade', duration: '1 Rodada', icon: 'fas fa-chevron-down' },
            { id: 'voo', name: 'Voo', description: 'Concede capacidade de voar.', type: 'positivo', category: 'Movimento', duration: '10 Minutos', icon: 'fas fa-feather-alt' },
            { id: 'sangramento', name: 'Sangramento', description: 'Causa dano de perfuração ou corte a cada turno.', type: 'negativo', category: 'Dano', duration: '3 Turnos', icon: 'fas fa-tint' },
            { id: 'charmoso', name: 'Charmoso', description: 'O alvo se torna amigável com o conjurador, mas não um aliado.', type: 'negativo', category: 'Controle', duration: '1 Hora', icon: 'fas fa-grin-hearts' },
            { id: 'petrificado', name: 'Petrificado', description: 'Transformado em pedra, imune a dano, mas incapaz de agir.', type: 'negativo', category: 'Controle', duration: 'Permanente', icon: 'fas fa-stone' },
            { id: 'restauracao-menor', name: 'Restauração Menor', description: 'Remove uma condição de status (ex: cegado, envenenado).', type: 'positivo', category: 'Cura/Utilidade', duration: 'Instantâneo', icon: 'fas fa-undo' },
            { id: 'compelir', name: 'Compelir', description: 'O alvo deve usar sua ação em seu próximo turno para seguir uma ordem.', type: 'negativo', category: 'Controle', duration: '1 Rodada', icon: 'fas fa-walking' },
            { id: 'aura-cura', name: 'Aura de Cura', description: 'Cura aliados próximos no início do turno do conjurador.', type: 'positivo', category: 'Cura', duration: 'Concentração', icon: 'fas fa-plus-square' }
        ];

        let savedMagics = []; // Stores saved spells
        let characterMagics = []; // Spells linked to the character sheet

        // --- DOM Elements ---
        const navLinks = document.querySelector('.main-nav .nav-links');
        const menuToggle = document.querySelector('.menu-toggle');
        const tabs = document.querySelectorAll('.tab-btn');
        const tabContents = document.querySelectorAll('.tab-content');
        const paOrbs = document.querySelectorAll('.pa-orb');
        const addPaBtn = document.getElementById('add-pa-btn');
        const usePaBtn = document.getElementById('use-pa-btn');
        const resetPaBtn = document.getElementById('reset-pa-btn');

        const wizardSteps = document.querySelectorAll('.wizard-step');
        const progressSteps = document.querySelectorAll('.progress-step');
        const magicNameInput = document.getElementById('magic-name');
        const magicDescriptionInput = document.getElementById('magic-description');
        const magicTypeSelector = document.getElementById('magic-type-selector');
        const magicTypeInput = document.getElementById('magic-type');
        const magicSchoolSelect = document.getElementById('magic-school');
        const magicRangeSelect = document.getElementById('magic-range');
        const magicAreaSelect = document.getElementById('magic-area');
        const magicDurationSelect = document.getElementById('magic-duration');
        const magicCostPaInput = document.getElementById('magic-cost-pa');
        const magicCooldownInput = document.getElementById('magic-cooldown');
        const magicVisualColorInput = document.getElementById('magic-visual-color');
        const magicVisualIconInput = document.getElementById('magic-visual-icon');
        const statusEffectSelect = document.getElementById('status-effect-select');
        const selectedEffectsList = document.getElementById('selected-effects-list');
        const noEffectsMessage = document.getElementById('no-effects-message');

        const previewName = document.getElementById('preview-name');
        const previewTypeSchool = document.getElementById('preview-type-school');
        const previewDescription = document.getElementById('preview-description');
        const previewRange = document.getElementById('preview-range');
        const previewArea = document.getElementById('preview-area');
        const previewDuration = document.getElementById('preview-duration');
        const previewPaValue = document.getElementById('preview-pa-value');
        const previewCooldown = document.getElementById('preview-cooldown');
        const previewEffectsList = document.getElementById('preview-effects-list');
        const previewIconDisplay = document.getElementById('preview-icon-display');

        const efeitosGrid = document.getElementById('efeitos-grid');
        const efeitosFilterButtons = document.querySelectorAll('.efeitos-filter .filter-btn');

        const elementosSelector = document.querySelector('.elementos-selector');
        const elementoContents = document.querySelectorAll('.elemento-content');

        const magicLibraryGrid = document.getElementById('magic-library-grid');
        const noMagicsMessage = document.getElementById('no-magics-message');
        const librarySearch = document.getElementById('library-search');
        const libraryFilterType = document.getElementById('library-filter-type');
        const libraryFilterSchool = document.getElementById('library-filter-school');

        const importModal = document.getElementById('import-modal');
        const importMagicCode = document.getElementById('import-magic-code');
        const importJsonFile = document.getElementById('import-json-file');
        const shareModal = document.getElementById('share-modal');
        const shareMagicCode = document.getElementById('share-magic-code');
        const exportMagicJsonBtn = document.getElementById('export-magic-json-btn');

        const charNameInput = document.getElementById('char-name');
        const charClassInput = document.getElementById('char-class');
        const charRaceInput = document.getElementById('char-race');
        const charLevelInput = document.getElementById('char-level');
        const hpCurrentInput = document.getElementById('hp-current');
        const hpMaxInput = document.getElementById('hp-max');
        const mpCurrentInput = document.getElementById('mp-current');
        const mpMaxInput = document.getElementById('mp-max');
        const paCharCurrentInput = document.getElementById('pa-char-current');
        const acValueInput = document.getElementById('ac-value');
        const initiativeValueInput = document.getElementById('initiative-value');
        const atributosInputs = document.querySelectorAll('.atributo-valor input[type="number"]');
        const especializacaoCheckboxes = document.querySelectorAll('.especializacao-grupo input[type="checkbox"]');
        const magiasPersonagemGrid = document.getElementById('magias-personagem-grid');
        const noCharMagicsMessage = document.getElementById('no-char-magics-message');
        const addMagicToCharModal = document.getElementById('add-magic-to-char-modal');
        const magicToAddSelect = document.getElementById('magic-to-add-select');


        // --- Utility Functions ---
        function generateUniqueId() {
            return Date.now().toString(36) + Math.random().toString(36).substring(2);
        }

        function calculateModifier(score) {
            return Math.floor((score - 10) / 2);
        }

        function displayMessage(message, type = 'info', duration = 3000) {
            const container = document.querySelector('.container'); // Or a dedicated message area
            const messageElement = document.createElement('div');
            messageElement.className = `fixed bottom-5 right-5 p-4 rounded-lg shadow-lg text-white z-50 animate-fade-in-up ${type === 'success' ? 'bg-green-500' : type === 'danger' ? 'bg-red-500' : 'bg-blue-500'}`;
            messageElement.textContent = message;
            document.body.appendChild(messageElement);

            setTimeout(() => {
                messageElement.classList.add('animate-fade-out-down');
                messageElement.addEventListener('animationend', () => messageElement.remove());
            }, duration);
        }

        // --- Local Storage Management ---
        function saveToLocalStorage(key, data) {
            try {
                localStorage.setItem(key, JSON.stringify(data));
                return true;
            } catch (e) {
                console.error("Error saving to local storage:", e);
                displayMessage("Erro ao salvar dados localmente.", "danger");
                return false;
            }
        }

        function loadFromLocalStorage(key) {
            try {
                const data = localStorage.getItem(key);
                return data ? JSON.parse(data) : null;
            } catch (e) {
                console.error("Error loading from local storage:", e);
                displayMessage("Erro ao carregar dados localmente.", "danger");
                return null;
            }
        }

        // --- Navigation ---
        menuToggle.addEventListener('click', () => {
            navLinks.classList.toggle('active');
        });

        document.querySelectorAll('.main-nav .nav-links a').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                document.querySelector('.main-nav .nav-links a.active')?.classList.remove('active');
                this.classList.add('active');

                const targetId = this.getAttribute('href');
                document.querySelector(targetId).scrollIntoView({
                    behavior: 'smooth'
                });

                // Close mobile menu if open
                if (navLinks.classList.contains('active')) {
                    navLinks.classList.remove('active');
                }
            });
        });

        // Smooth scroll for hero section indicator
        document.querySelector('.scroll-indicator').addEventListener('click', function(e) {
            e.preventDefault();
            document.getElementById('system').scrollIntoView({
                behavior: 'smooth'
            });
        });

        // --- System Tabs ---
        tabs.forEach(button => {
            button.addEventListener('click', () => {
                // Deactivate all tabs and content
                tabs.forEach(btn => btn.classList.remove('active'));
                tabContents.forEach(content => content.classList.remove('active'));

                // Activate clicked tab and its content
                button.classList.add('active');
                document.getElementById(`${button.dataset.tab}-content`).classList.add('active');
            });
        });

        // --- PA System Logic ---
        function updatePACounter() {
            paOrbs.forEach((orb, index) => {
                if (index < currentPA) {
                    orb.classList.add('active');
                } else {
                    orb.classList.remove('active');
                }
            });
            addPaBtn.disabled = currentPA >= maxPA;
            usePaBtn.disabled = currentPA <= 0;
            paCharCurrentInput.value = currentPA; // Sync with character sheet
        }

        addPaBtn.addEventListener('click', () => {
            if (currentPA < maxPA) {
                currentPA++;
                updatePACounter();
            }
        });

        usePaBtn.addEventListener('click', () => {
            if (currentPA > 0) {
                currentPA--;
                updatePACounter();
            }
        });

        resetPaBtn.addEventListener('click', () => {
            currentPA = 3; // Starting PA
            updatePACounter();
        });

        // Sync PA from character sheet
        paCharCurrentInput.addEventListener('change', (e) => {
            let newValue = parseInt(e.target.value);
            if (isNaN(newValue) || newValue < 0) newValue = 0;
            if (newValue > maxPA) newValue = maxPA;
            currentPA = newValue;
            updatePACounter();
            saveCharacter(); // Save character state
        });


        // --- Escolas & Elementos Tab Logic ---
        elementosSelector.addEventListener('click', (e) => {
            if (e.target.classList.contains('elemento-btn')) {
                document.querySelectorAll('.elemento-btn').forEach(btn => btn.classList.remove('active'));
                e.target.classList.add('active');

                const selectedElement = e.target.dataset.elemento;
                elementoContents.forEach(content => {
                    if (content.id === `elemento-${selectedElement}`) {
                        content.classList.add('active');
                    } else {
                        content.classList.remove('active');
                    }
                });
            }
        });

        // --- Efeitos de Status Tab Logic ---
        function renderStatusEffects(filter = 'all') {
            efeitosGrid.innerHTML = ''; // Clear current effects

            const filteredEffects = allStatusEffects.filter(effect => {
                if (filter === 'all') return true;
                return effect.type === filter;
            });

            if (filteredEffects.length === 0) {
                efeitosGrid.innerHTML = '<p class="text-center text-gray-500 col-span-full">Nenhum efeito encontrado para este filtro.</p>';
                return;
            }

            filteredEffects.forEach(effect => {
                const card = document.createElement('div');
                card.className = `efeito-card ${effect.type}`;
                card.setAttribute('data-type', effect.type);
                card.innerHTML = `
                    <div class="efeito-icon"><i class="${effect.icon}"></i></div>
                    <h4 class="text-lg font-cinzel text-primary-color mb-2">${effect.name}</h4>
                    <p class="text-gray-700">${effect.description}</p>
                    <div class="efeito-details-info">
                        <span><i class="fas fa-tag"></i> ${effect.category}</span>
                        <span><i class="fas fa-clock"></i> ${effect.duration}</span>
                    </div>
                `;
                efeitosGrid.appendChild(card);
            });
        }

        efeitosFilterButtons.forEach(button => {
            button.addEventListener('click', () => {
                efeitosFilterButtons.forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');
                renderStatusEffects(button.dataset.filter);
            });
        });


        // --- Magic Creation Wizard Logic ---
        function updateWizardUI() {
            // Update progress steps
            progressSteps.forEach((step, index) => {
                if (index + 1 === currentStep) {
                    step.classList.add('active');
                } else {
                    step.classList.remove('active');
                }
            });

            // Show/hide wizard steps
            wizardSteps.forEach((step, index) => {
                if (index + 1 === currentStep) {
                    step.classList.add('active');
                } else {
                    step.classList.remove('active');
                }
            });

            // Update preview
            updateMagicPreview();

            // Enable/disable 'Previous' button
            const prevButton = wizardSteps[currentStep - 1].querySelector('.btn-secondary');
            if (prevButton) {
                if (currentStep === 1) {
                    prevButton.classList.add('disabled');
                    prevButton.disabled = true;
                } else {
                    prevButton.classList.remove('disabled');
                    prevButton.disabled = false;
                }
            }
        }

        function nextStep() {
            if (validateCurrentStep()) {
                if (currentStep < totalSteps) {
                    currentStep++;
                    updateWizardUI();
                }
            } else {
                displayMessage("Por favor, preencha todos os campos obrigatórios.", "danger");
            }
        }

        function prevStep() {
            if (currentStep > 1) {
                currentStep--;
                updateWizardUI();
            }
        }

        function validateCurrentStep() {
            // Basic validation for each step
            switch (currentStep) {
                case 1:
                    if (!magicNameInput.value.trim() || !magicDescriptionInput.value.trim()) return false;
                    newMagic.name = magicNameInput.value.trim();
                    newMagic.description = magicDescriptionInput.value.trim();
                    break;
                case 2:
                    if (!magicTypeInput.value || !magicSchoolSelect.value) return false;
                    newMagic.type = magicTypeInput.value;
                    newMagic.school = magicSchoolSelect.value;
                    break;
                case 3:
                    // For multiple selects, check if at least one option is selected
                    const selectedRange = Array.from(magicRangeSelect.selectedOptions).map(option => option.value);
                    const selectedArea = Array.from(magicAreaSelect.selectedOptions).map(option => option.value);
                    const selectedDuration = Array.from(magicDurationSelect.selectedOptions).map(option => option.value);

                    if (selectedRange.length === 0 || selectedArea.length === 0 || selectedDuration.length === 0) return false;
                    newMagic.range = selectedRange;
                    newMagic.area = selectedArea;
                    newMagic.duration = selectedDuration;
                    break;
                case 4:
                    if (isNaN(parseInt(magicCostPaInput.value)) || parseInt(magicCostPaInput.value) < 1 || isNaN(parseInt(magicCooldownInput.value)) || !magicVisualIconInput.value.trim()) return false;
                    newMagic.costPA = parseInt(magicCostPaInput.value);
                    newMagic.cooldown = parseInt(magicCooldownInput.value);
                    newMagic.visualColor = magicVisualColorInput.value;
                    newMagic.visualIcon = magicVisualIconInput.value.trim();
                    break;
                case 5:
                    // Effects are optional, so no strict validation here.
                    // newMagic.effects is updated by addSelectedEffect/removeEffect
                    break;
                case 6:
                    // Final review, no new inputs to validate
                    break;
            }
            return true;
        }

        // Event listeners for magic creation inputs to update preview
        magicNameInput.addEventListener('input', () => newMagic.name = magicNameInput.value);
        magicDescriptionInput.addEventListener('input', () => newMagic.description = magicDescriptionInput.value);
        magicSchoolSelect.addEventListener('change', () => newMagic.school = magicSchoolSelect.value);
        magicCostPaInput.addEventListener('input', () => newMagic.costPA = parseInt(magicCostPaInput.value) || 0);
        magicCooldownInput.addEventListener('input', () => newMagic.cooldown = parseInt(magicCooldownInput.value) || 0);
        magicVisualColorInput.addEventListener('input', () => newMagic.visualColor = magicVisualColorInput.value);
        magicVisualIconInput.addEventListener('input', () => newMagic.visualIcon = magicVisualIconInput.value);

        magicRangeSelect.addEventListener('change', () => {
            newMagic.range = Array.from(magicRangeSelect.selectedOptions).map(option => option.value);
        });
        magicAreaSelect.addEventListener('change', () => {
            newMagic.area = Array.from(magicAreaSelect.selectedOptions).map(option => option.value);
        });
        magicDurationSelect.addEventListener('change', () => {
            newMagic.duration = Array.from(magicDurationSelect.selectedOptions).map(option => option.value);
        });

        magicTypeSelector.addEventListener('click', (e) => {
            const targetOption = e.target.closest('.tipo-option');
            if (targetOption) {
                // Remove 'selected' from all
                magicTypeSelector.querySelectorAll('.tipo-option').forEach(option => {
                    option.classList.remove('selected');
                });
                // Add 'selected' to clicked
                targetOption.classList.add('selected');
                magicTypeInput.value = targetOption.dataset.value; // Set hidden input value
                newMagic.type = targetOption.dataset.value;
            }
        });

        // Populate status effects dropdown
        function populateStatusEffectsDropdown() {
            statusEffectSelect.innerHTML = '<option value="">Selecione um efeito</option>';
            allStatusEffects.forEach(effect => {
                const option = document.createElement('option');
                option.value = effect.id;
                option.textContent = `${effect.name} (${effect.type === 'positivo' ? 'Positivo' : 'Negativo'})`;
                statusEffectSelect.appendChild(option);
            });
        }

        function addSelectedEffect() {
            const selectedEffectId = statusEffectSelect.value;
            if (selectedEffectId && !newMagic.effects.some(e => e.id === selectedEffectId)) {
                const effectToAdd = allStatusEffects.find(effect => effect.id === selectedEffectId);
                if (effectToAdd) {
                    newMagic.effects.push(effectToAdd);
                    renderSelectedEffects();
                    statusEffectSelect.value = ''; // Reset dropdown
                }
            } else if (selectedEffectId) {
                displayMessage("Este efeito já foi adicionado.", "info");
            }
        }

        function removeEffect(effectIdToRemove) {
            newMagic.effects = newMagic.effects.filter(effect => effect.id !== effectIdToRemove);
            renderSelectedEffects();
        }

        function renderSelectedEffects() {
            selectedEffectsList.innerHTML = '';
            if (newMagic.effects.length === 0) {
                noEffectsMessage.classList.remove('hidden');
            } else {
                noEffectsMessage.classList.add('hidden');
                newMagic.effects.forEach(effect => {
                    const item = document.createElement('div');
                    item.className = 'selected-effect-item';
                    item.innerHTML = `
                        <span><i class="${effect.icon} ${effect.type === 'positivo' ? 'text-green-400' : 'text-red-400'}"></i> ${effect.name} (${effect.duration})</span>
                        <button class="remove-effect-btn" onclick="removeEffect('${effect.id}')"><i class="fas fa-times"></i></button>
                    `;
                    selectedEffectsList.appendChild(item);
                });
            }
        }


        function updateMagicPreview() {
            previewName.textContent = newMagic.name || 'Nome da Magia';
            previewTypeSchool.textContent = `${newMagic.type || 'Tipo'} | ${newMagic.school || 'Escola'}`;
            previewDescription.textContent = newMagic.description || 'Descrição da magia...';
            previewRange.textContent = newMagic.range.join(', ') || 'Nenhum';
            previewArea.textContent = newMagic.area.join(', ') || 'Nenhum';
            previewDuration.textContent = newMagic.duration.join(', ') || 'Nenhum';
            previewPaValue.textContent = newMagic.costPA;
            previewCooldown.textContent = `${newMagic.cooldown} Turnos`;

            previewIconDisplay.innerHTML = `<i class="${newMagic.visualIcon}"></i>`;
            previewIconDisplay.style.backgroundColor = newMagic.visualColor;

            if (newMagic.effects.length > 0) {
                previewEffectsList.innerHTML = newMagic.effects.map(e => `<strong>${e.name}:</strong> ${e.description} (${e.duration})`).join('<br>');
            } else {
                previewEffectsList.textContent = 'Nenhum';
            }
        }

        function saveMagic() {
            if (validateCurrentStep()) {
                newMagic.id = generateUniqueId(); // Assign a unique ID
                savedMagics.push({ ...newMagic }); // Save a copy of the current magic state
                saveToLocalStorage('savedMagics', savedMagics);
                displayMessage('Magia salva com sucesso na biblioteca!', 'success');
                resetMagicCreationForm();
                loadMagicsIntoLibrary(); // Reload library
                currentStep = 1; // Reset wizard to step 1
                updateWizardUI();
                window.scrollTo({ top: 0, behavior: 'smooth' }); // Scroll to top for new creation
            } else {
                displayMessage("Por favor, preencha todos os campos antes de salvar.", "danger");
            }
        }

        function resetMagicCreationForm() {
            newMagic = {
                id: '',
                name: '',
                description: '',
                type: '',
                school: '',
                range: [],
                area: [],
                duration: [],
                costPA: 1,
                cooldown: 0,
                visualColor: '#8a4fff',
                visualIcon: 'fas fa-hat-wizard',
                effects: []
            };

            magicNameInput.value = '';
            magicDescriptionInput.value = '';

            magicTypeSelector.querySelectorAll('.tipo-option').forEach(option => option.classList.remove('selected'));
            magicTypeInput.value = '';
            magicSchoolSelect.value = '';

            // Reset multiple selects
            Array.from(magicRangeSelect.options).forEach(option => option.selected = false);
            Array.from(magicAreaSelect.options).forEach(option => option.selected = false);
            Array.from(magicDurationSelect.options).forEach(option => option.selected = false);

            magicCostPaInput.value = 1;
            magicCooldownInput.value = 0;
            magicVisualColorInput.value = '#8a4fff';
            magicVisualIconInput.value = 'fas fa-hat-wizard';

            renderSelectedEffects(); // Clear selected effects list
            populateStatusEffectsDropdown(); // Re-populate dropdown
        }


        // --- Magic Library Logic ---
        function loadMagicsIntoLibrary() {
            const storedMagics = loadFromLocalStorage('savedMagics');
            if (storedMagics) {
                savedMagics = storedMagics;
            }
            filterAndRenderMagics();
        }

        function filterAndRenderMagics() {
            magicLibraryGrid.innerHTML = '';
            const searchTerm = librarySearch.value.toLowerCase();
            const filterType = libraryFilterType.value;
            const filterSchool = libraryFilterSchool.value;

            const filteredMagics = savedMagics.filter(magic => {
                const matchesSearch = magic.name.toLowerCase().includes(searchTerm) ||
                                      magic.description.toLowerCase().includes(searchTerm);
                const matchesType = filterType === 'all' || magic.type === filterType;
                const matchesSchool = filterSchool === 'all' || magic.school === filterSchool;
                return matchesSearch && matchesType && matchesSchool;
            });

            if (filteredMagics.length === 0) {
                magicLibraryGrid.innerHTML = '<p class="text-center text-gray-500 col-span-full">Nenhuma magia encontrada com os filtros atuais.</p>';
                noMagicsMessage.classList.remove('hidden'); // Show if no magics at all
                if (savedMagics.length > 0) { // If there are magics but none match filter
                    noMagicsMessage.classList.add('hidden'); // Hide if some magics are present
                }
            } else {
                noMagicsMessage.classList.add('hidden');
                filteredMagics.forEach(magic => {
                    const card = document.createElement('div');
                    card.className = 'library-magic-card';
                    card.innerHTML = `
                        <h4 class="text-xl font-cinzel text-primary-color mb-2">${magic.name}</h4>
                        <p class="text-gray-700 text-sm mb-2">${magic.type} | ${magic.school}</p>
                        <p class="text-gray-600 text-sm mb-4 truncate">${magic.description}</p>
                        <div class="flex items-center justify-between text-sm text-gray-500">
                            <span>PA: ${magic.costPA}</span>
                            <span>CD: ${magic.cooldown}</span>
                        </div>
                        <div class="library-card-actions">
                            <button class="btn btn-secondary" onclick="viewMagicDetails('${magic.id}')">
                                <i class="fas fa-eye"></i> Detalhes
                            </button>
                            <button class="btn btn-primary" onclick="openShareModal('${magic.id}')">
                                <i class="fas fa-share-alt"></i> Compartilhar 
                            </button>
                            <button class="btn btn-danger" onclick="deleteMagic('${magic.id}')">
                                <i class="fas fa-trash"></i> Excluir
                            </button>
                        </div>
                    `;
                    magicLibraryGrid.appendChild(card);
                });
            }
        }

        librarySearch.addEventListener('input', filterAndRenderMagics);
        libraryFilterType.addEventListener('change', filterAndRenderMagics);
        libraryFilterSchool.addEventListener('change', filterAndRenderMagics);

        function viewMagicDetails(magicId) {
            const magic = savedMagics.find(m => m.id === magicId);
            if (!magic) {
                displayMessage("Magia não encontrada.", "danger");
                return;
            }

            // Create a temporary modal-like display for details
            const modalContent = `
                <div class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4">
                    <div class="bg-gray-800 text-white rounded-lg shadow-xl max-w-lg w-full p-6 relative">
                        <button class="absolute top-3 right-3 text-gray-400 hover:text-white text-2xl" onclick="this.closest('.fixed').remove()">&times;</button>
                        <h3 class="text-2xl font-cinzel mb-3">${magic.name}</h3>
                        <p class="text-sm text-gray-400 mb-4">${magic.type} | ${magic.school}</p>
                        <p class="mb-4">${magic.description}</p>
                        <div class="grid grid-cols-2 gap-3 mb-4 text-sm">
                            <div class="bg-gray-700 p-2 rounded"><strong>Alcance:</strong> ${magic.range.join(', ')}</div>
                            <div class="bg-gray-700 p-2 rounded"><strong>Área:</strong> ${magic.area.join(', ')}</div>
                            <div class="bg-gray-700 p-2 rounded"><strong>Duração:</strong> ${magic.duration.join(', ')}</div>
                            <div class="bg-gray-700 p-2 rounded"><strong>Custo PA:</strong> ${magic.costPA}</div>
                            <div class="bg-gray-700 p-2 rounded"><strong>Cooldown:</strong> ${magic.cooldown} turnos</div>
                        </div>
                        <div class="mb-4">
                            <h5 class="font-cinzel text-lg mb-2">Efeitos:</h5>
                            ${magic.effects.length > 0 ? magic.effects.map(e => `<p class="text-sm"><i class="${e.icon} ${e.type === 'positivo' ? 'text-green-400' : 'text-red-400'}"></i> <strong>${e.name}:</strong> ${e.description} (${e.duration})</p>`).join('') : '<p class="text-sm text-gray-400">Nenhum efeito.</p>'}
                        </div>
                        <div class="flex justify-center mt-4">
                            <div class="w-20 h-20 rounded-full flex items-center justify-center text-3xl" style="background-color: ${magic.visualColor}; color: white;">
                                <i class="${magic.visualIcon}"></i>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', modalContent);
        }

        function deleteMagic(magicId) {
            if (confirm('Tem certeza que deseja excluir esta magia?')) {
                savedMagics = savedMagics.filter(magic => magic.id !== magicId);
                saveToLocalStorage('savedMagics', savedMagics);
                loadMagicsIntoLibrary();
                displayMessage('Magia excluída com sucesso!', 'success');
            }
        }

        // --- Share/Import Modals ---
        function openImportModal() {
            importModal.style.display = 'flex';
        }

        function closeImportModal() {
            importModal.style.display = 'none';
            importMagicCode.value = '';
            importJsonFile.value = '';
        }

        function importMagicFromModal() {
            let magicData = null;
            if (importMagicCode.value.trim()) {
                try {
                    magicData = JSON.parse(importMagicCode.value);
                } catch (e) {
                    displayMessage("Código JSON inválido.", "danger");
                    return;
                }
            } else if (importJsonFile.files.length > 0) {
                const file = importJsonFile.files[0];
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        magicData = JSON.parse(e.target.result);
                        processImportedMagic(magicData);
                    } catch (err) {
                        displayMessage("Erro ao ler arquivo JSON.", "danger");
                    }
                };
                reader.readAsText(file);
                return; // Exit here, processing continues in reader.onload
            } else {
                displayMessage("Por favor, cole um código ou selecione um arquivo.", "danger");
                return;
            }

            processImportedMagic(magicData);
        }

        function processImportedMagic(magicData) {
            if (magicData && magicData.name && magicData.description) {
                // Ensure it has a unique ID, even if imported one exists
                magicData.id = generateUniqueId();
                savedMagics.push(magicData);
                saveToLocalStorage('savedMagics', savedMagics);
                loadMagicsIntoLibrary();
                displayMessage('Magia importada com sucesso!', 'success');
                closeImportModal();
            } else {
                displayMessage("Dados da magia incompletos ou inválidos.", "danger");
            }
        }

        function openShareModal(magicId) {
            const magicToShare = savedMagics.find(m => m.id === magicId);
            if (magicToShare) {
                shareMagicCode.value = JSON.stringify(magicToShare, null, 2);
                exportMagicJsonBtn.onclick = () => exportMagicAsJson(magicToShare);
                shareModal.style.display = 'flex';
            } else {
                displayMessage("Magia não encontrada para compartilhamento.", "danger");
            }
        }

        function closeShareModal() {
            shareModal.style.display = 'none';
            shareMagicCode.value = '';
        }

        function copyShareCode() {
            shareMagicCode.select();
            document.execCommand('copy');
            displayMessage('Código copiado para a área de transferência!', 'success');
        }

        function exportMagicAsJson(magic) {
            const dataStr = JSON.stringify(magic, null, 2);
            const blob = new Blob([dataStr], { type: "application/json" });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${magic.name.replace(/[^a-z0-9]/gi, '_')}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            displayMessage('Magia exportada como JSON!', 'success');
        }

        function exportAllMagics() {
            if (savedMagics.length === 0) {
                displayMessage("Nenhuma magia para exportar.", "info");
                return;
            }
            const dataStr = JSON.stringify(savedMagics, null, 2);
            const blob = new Blob([dataStr], { type: "application/json" });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `minhas_magias_rpg_${new Date().toISOString().slice(0, 10)}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            displayMessage('Todas as magias exportadas como JSON!', 'success');
        }

        // --- Character Sheet Logic ---
        function calculateAndDisplayModifiers() {
            atributosInputs.forEach(input => {
                const score = parseInt(input.value);
                const modifier = calculateModifier(score);
                const modElement = document.getElementById(`mod-${input.id.split('-')[1]}`);
                modElement.textContent = (modifier >= 0 ? '+' : '') + modifier;
            });
        }

        atributosInputs.forEach(input => {
            input.addEventListener('input', calculateAndDisplayModifiers);
        });

        function loadCharacter() {
            const savedCharacter = loadFromLocalStorage('characterSheet');
            if (savedCharacter) {
                charNameInput.value = savedCharacter.name || '';
                charClassInput.value = savedCharacter.class || '';
                charRaceInput.value = savedCharacter.race || '';
                charLevelInput.value = savedCharacter.level || 1;
                hpCurrentInput.value = savedCharacter.hpCurrent || 0;
                hpMaxInput.value = savedCharacter.hpMax || 0;
                mpCurrentInput.value = savedCharacter.mpCurrent || 0;
                mpMaxInput.value = savedCharacter.mpMax || 0;
                paCharCurrentInput.value = savedCharacter.paCurrent || 3;
                acValueInput.value = savedCharacter.ac || 0;
                initiativeValueInput.value = savedCharacter.initiative || 0;

                for (const attr in savedCharacter.attributes) {
                    const input = document.getElementById(`attr-${attr}`);
                    if (input) input.value = savedCharacter.attributes[attr];
                }
                calculateAndDisplayModifiers(); // Recalculate after loading attributes

                especializacaoCheckboxes.forEach(checkbox => {
                    checkbox.checked = savedCharacter.specializations[checkbox.id] || false;
                });

                characterMagics = savedCharacter.magics || [];
                renderCharacterMagics();
                currentPA = savedCharacter.paCurrent || 3; // Sync global PA counter
                updatePACounter();

                displayMessage('Ficha de personagem carregada!', 'success');
            } else {
                displayMessage('Nenhuma ficha de personagem salva encontrada.', 'info');
            }
        }

        function saveCharacter() {
            const characterData = {
                name: charNameInput.value,
                class: charClassInput.value,
                race: charRaceInput.value,
                level: parseInt(charLevelInput.value) || 1,
                hpCurrent: parseInt(hpCurrentInput.value) || 0,
                hpMax: parseInt(hpMaxInput.value) || 0,
                mpCurrent: parseInt(mpCurrentInput.value) || 0,
                mpMax: parseInt(mpMaxInput.value) || 0,
                paCurrent: parseInt(paCharCurrentInput.value) || 3,
                ac: parseInt(acValueInput.value) || 0,
                initiative: parseInt(initiativeValueInput.value) || 0,
                attributes: {},
                specializations: {},
                magics: characterMagics
            };

            atributosInputs.forEach(input => {
                characterData.attributes[input.id.split('-')[1]] = parseInt(input.value) || 0;
            });

            especializacaoCheckboxes.forEach(checkbox => {
                characterData.specializations[checkbox.id] = checkbox.checked;
            });

            if (saveToLocalStorage('characterSheet', characterData)) {
                displayMessage('Ficha de personagem salva com sucesso!', 'success');
            }
        }

        function resetCharacterSheet() {
            if (confirm('Tem certeza que deseja resetar a ficha de personagem? Isso apagará todos os dados.')) {
                charNameInput.value = '';
                charClassInput.value = '';
                charRaceInput.value = '';
                charLevelInput.value = 1;
                hpCurrentInput.value = 10;
                hpMaxInput.value = 10;
                mpCurrentInput.value = 5;
                mpMaxInput.value = 5;
                paCharCurrentInput.value = 3;
                acValueInput.value = 10;
                initiativeValueInput.value = 0;

                atributosInputs.forEach(input => {
                    input.value = 10;
                });
                calculateAndDisplayModifiers();

                especializacaoCheckboxes.forEach(checkbox => {
                    checkbox.checked = false;
                });

                characterMagics = [];
                renderCharacterMagics();
                currentPA = 3; // Reset global PA counter
                updatePACounter();

                localStorage.removeItem('characterSheet');
                displayMessage('Ficha de personagem resetada!', 'info');
            }
        }

        function openAddMagicToCharacterModal() {
            magicToAddSelect.innerHTML = '<option value="">Selecione uma magia</option>';
            if (savedMagics.length === 0) {
                magicToAddSelect.innerHTML = '<option value="">Nenhuma magia na biblioteca</option>';
                magicToAddSelect.disabled = true;
            } else {
                magicToAddSelect.disabled = false;
                savedMagics.forEach(magic => {
                    const option = document.createElement('option');
                    option.value = magic.id;
                    option.textContent = `${magic.name} (PA: ${magic.costPA}, CD: ${magic.cooldown})`;
                    magicToAddSelect.appendChild(option);
                });
            }
            addMagicToCharModal.style.display = 'flex';
        }

        function closeAddMagicToCharacterModal() {
            addMagicToCharModal.style.display = 'none';
        }

        function addMagicToCharacter() {
            const selectedMagicId = magicToAddSelect.value;
            if (selectedMagicId) {
                const magic = savedMagics.find(m => m.id === selectedMagicId);
                if (magic && !characterMagics.some(m => m.id === magic.id)) {
                    characterMagics.push({ ...magic, currentCooldown: 0 }); // Add with initial cooldown
                    saveCharacter();
                    renderCharacterMagics();
                    displayMessage('Magia adicionada à ficha!', 'success');
                    closeAddMagicToCharacterModal();
                } else if (magic) {
                    displayMessage('Esta magia já está na ficha do personagem.', 'info');
                }
            } else {
                displayMessage('Por favor, selecione uma magia.', 'danger');
            }
        }

        function removeMagicFromCharacter(magicId) {
            if (confirm('Tem certeza que deseja remover esta magia da ficha?')) {
                characterMagics = characterMagics.filter(magic => magic.id !== magicId);
                saveCharacter();
                renderCharacterMagics();
                displayMessage('Magia removida da ficha.', 'info');
            }
        }

        function useMagic(magicId) {
            const magicIndex = characterMagics.findIndex(m => m.id === magicId);
            if (magicIndex === -1) return;

            const magic = characterMagics[magicIndex];

            // Apply specialization discount
            let effectiveCost = magic.costPA;
            especializacaoCheckboxes.forEach(checkbox => {
                if (checkbox.checked) {
                    if (checkbox.dataset.school === magic.school || checkbox.dataset.element === magic.element) {
                        effectiveCost = Math.max(1, effectiveCost - 1); // Reduce PA by 1, minimum 1
                    }
                }
            });

            if (currentPA >= effectiveCost) {
                if (magic.currentCooldown <= 0) {
                    currentPA -= effectiveCost;
                    magic.currentCooldown = magic.cooldown; // Set cooldown
                    updatePACounter();
                    saveCharacter();
                    renderCharacterMagics();
                    displayMessage(`${magic.name} usada! PA restante: ${currentPA}. Cooldown: ${magic.cooldown} turnos.`, 'success');
                } else {
                    displayMessage(`${magic.name} está em cooldown! Restam ${magic.currentCooldown} turnos.`, 'danger');
                }
            } else {
                displayMessage(`PA insuficiente para usar ${magic.name}. Custo: ${effectiveCost}, PA atual: ${currentPA}.`, 'danger');
            }
        }

        function endTurn() {
            currentPA = Math.min(maxPA, currentPA + 1); // Gain 1 PA
            characterMagics.forEach(magic => {
                if (magic.currentCooldown > 0) {
                    magic.currentCooldown--;
                }
            });
            updatePACounter();
            saveCharacter();
            renderCharacterMagics();
            displayMessage('Fim de turno! PA recuperado e cooldowns atualizados.', 'info');
        }

        function renderCharacterMagics() {
            magiasPersonagemGrid.innerHTML = '';
            if (characterMagics.length === 0) {
                noCharMagicsMessage.classList.remove('hidden');
            } else {
                noCharMagicsMessage.classList.add('hidden');
                characterMagics.forEach(magic => {
                    // Apply specialization discount for display
                    let effectiveCost = magic.costPA;
                    especializacaoCheckboxes.forEach(checkbox => {
                        if (checkbox.checked) {
                            if (checkbox.dataset.school === magic.school || checkbox.dataset.element === magic.element) {
                                effectiveCost = Math.max(1, effectiveCost - 1);
                            }
                        }
                    });

                    const card = document.createElement('div');
                    card.className = 'magia-ficha-card';
                    card.innerHTML = `
                        <button class="magia-delete-btn" onclick="removeMagicFromCharacter('${magic.id}')"><i class="fas fa-times"></i></button>
                        <h5 class="text-lg font-cinzel text-primary-color">${magic.name}</h5>
                        <p class="text-gray-700 text-sm">${magic.type} | ${magic.school}</p>
                        <div class="magia-details mt-2">
                            <p><strong>Custo PA:</strong> ${effectiveCost} <span class="${magic.costPA > effectiveCost ? 'text-green-500' : ''}">${magic.costPA > effectiveCost ? `(-${magic.costPA - effectiveCost} Esp.)` : ''}</span></p>
                            <p><strong>Cooldown:</strong> ${magic.currentCooldown > 0 ? `<span class="text-red-500">${magic.currentCooldown}</span>` : magic.cooldown} turnos</p>
                            <p class="text-xs text-gray-500 mt-2">${magic.description.substring(0, 70)}...</p>
                        </div>
                        <div class="magia-ficha-actions">
                            <button class="btn btn-primary" onclick="useMagic('${magic.id}')" ${currentPA < effectiveCost || magic.currentCooldown > 0 ? 'disabled' : ''}>
                                <i class="fas fa-hand-point-up"></i> Usar Magia 
                            </button>
                            <button class="btn btn-secondary" onclick="viewMagicDetails('${magic.id}')">
                                <i class="fas fa-eye"></i> Detalhes
                            </button>
                        </div>
                    `;
                    magiasPersonagemGrid.appendChild(card);
                });
            }
        }

        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            updatePACounter();
            renderStatusEffects('all');
            populateStatusEffectsDropdown();
            updateWizardUI(); // Initialize wizard on page load

            // Load saved data
            loadMagicsIntoLibrary();
            loadCharacter();

            // Event listener for specialization checkboxes to trigger re-render of character magics
            especializacaoCheckboxes.forEach(checkbox => {
                checkbox.addEventListener('change', () => {
                    saveCharacter(); // Save character state after changing specialization
                    renderCharacterMagics(); // Re-render magics to reflect cost changes
                });
            });

            // Auto-save/load basic character info on input change
            [charNameInput, charClassInput, charRaceInput, charLevelInput, hpCurrentInput, hpMaxInput, mpCurrentInput, mpMaxInput, acValueInput, initiativeValueInput].forEach(input => {
                input.addEventListener('change', saveCharacter);
            });
        });

        // Optional: Add a general "End Turn" button to the character sheet or globally for cooldowns
        // For simplicity, let's add it to the character sheet for now:
        const endTurnBtnContainer = document.createElement('div');
        endTurnBtnContainer.className = 'flex justify-center mt-4';
        endTurnBtnContainer.innerHTML = `<button class="btn btn-info" onclick="endTurn()"><i class="fas fa-hourglass-end mr-2"></i> Passar Turno</button>`;
        document.querySelector('.ficha-container').appendChild(endTurnBtnContainer);

    </script>
</body>
</html>